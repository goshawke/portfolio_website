YUI.add("photo-group-invitations-models",(function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ListFetchers["flickr-photos-getGroupInvitations"].run(e,this.appContext)},acceptInvitation:function(e,i){return t.ModelUpdaters["flickr-groups-invite-photo-accept"].run(e,i)},declineInvitation:function(e,i){return t.ModelUpdaters["flickr-groups-invite-photo-decline"].run(e,i)}},attributes:{id:{},groups:{isListProxy:!0},invitations:{isListProxy:!0},total:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photos-getGroupInvitations-fetcher","flickr-groups-invite-photo-accept-updater","flickr-groups-invite-photo-decline-updater"]});YUI.add("sub-photo-groups-view",(function(t,e){var o=require("hermes-core/flog")(e);t.FlickrView.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.photoId=t.photoId,this.list=[],this.loading=!1,this.removing={},this.accepting={},this.startAmount=6,this.perPage=50,this.displayAmount=this.startAmount,this.addKeyShortcut="down:71",this.wasInvitation=[],void 0!==this.getViewDataFromHistory("displayAmount")&&(this.startAmount=this.getViewDataFromHistory("displayAmount"),this.displayAmount=this.getViewDataFromHistory("displayAmount")),""===this.get("container").get("innerHTML")&&this.setContainerHTML("")},loadState:function(){var e,o=this;return e={photoGroupsModel:this.appContext.getModel("photo-groups-models",this.photoId),photoModel:this.appContext.getModel("photo-models",this.photoId),photoPrivacyModel:this.appContext.getModel("photo-privacy-models",this.photoId)},this.appContext.getViewer().signedIn&&(e.photoGroupInvitationsModel=this.appContext.getModel("photo-group-invitations-models",this.photoId),e.personGroupsModel=this.appContext.getModel("person-groups-models",this.appContext.getViewer().nsid)),new t.FlickrPromise(e).then((function(e){return t.Object.each(e,(function(t,e){o.set(e,t)})),o.loadListData()}))},loadListData:function(){var e=this;return this.loading=!0,new t.FlickrPromise({invitations:this.getInvitations(this.displayAmount),groups:this.getGroups(this.displayAmount)}).then((function(o){var i,n,s,a,r,l=e.list,h=[];return e.loading=!1,h=[],o.invitations.length&&(h=h.concat(o.invitations)),h.length<e.displayAmount&&o.groups.length&&(n=function(t,o){var i=t.getValue("group").getValue("isAdmin"),n=o.getValue("group").getValue("isAdmin"),s=e.wasInvitation.indexOf(t.id),a=e.wasInvitation.indexOf(o.id);return s>-1&&a>-1?s>a?-1:1:s>-1?-1:a>-1?1:i>n?-1:n>i?1:0},h=o.invitations.concat(o.groups.sort(n))),h.length>e.displayAmount&&(h=h.slice(0,e.displayAmount)),(s=l)===(a=h)||s.length===a.length&&(r=!0,t.Array.some(s,(function(t,e){if(t!==a[e])return r=!1,!0})),r)?i=!1:(e.list=h,i=!0),{listChanged:i}}))},getInvitations:function(e){var o=this.get("photoGroupInvitationsModel"),i=o&&o.getValue("groups"),n=i&&i.getList();return n?t.Promise.resolve(n.slice(0,e)):t.Promise.resolve([])},getGroups:function(e){var o=this.get("photoGroupsModel"),i=o.getValue("groups").getList(),n=o.getValue("total");return e>n&&(e=n),i.length<e?o.getListPageByContinuation(e-i.length).then((function(){return o.getValue("groups").getList().slice(0,e)})):t.Promise.resolve(i.slice(0,e))},getInvitationModelForGroup:function(e){var o,i=this.get("photoGroupInvitationsModel"),n=i&&i.getValue("invitations").getList();return n&&t.Array.some(n,(function(t){if(t.getValue("groupId")===e)return o=t,!0})),o},canViewerRemove:function(t){var e=this.appContext.getViewer().nsid,o=this.get("photoModel").getValue("owner").getValue("id"),i=this.getInvitationModelForGroup(t.getValue("id")),n=t.getValue("group").getValue("isAdmin"),s=t.getValue("group").getValue("isModerator");return!!i?o===e||(!(!i||i.getValue("invitedBy")!==e)||!(!n&&!s)):o===e||!(!n&&!s)},canViewerAdd:function(){var t=this.appContext.getViewer().nsid,e=this.get("photoModel").getValue("owner").getValue("id"),o=this.get("personGroupsModel");return e===t&&o&&(this.get("personGroupsModel").getValue("memberCount")>0||this.get("personGroupsModel").getValue("adminCount")>0||this.get("personGroupsModel").getValue("moderatorCount")>0)},canViewerInvite:function(){var t=this.appContext.getViewer().nsid,e=this.get("photoModel").getValue("owner").getValue("id"),o=this.get("personGroupsModel");return e!==t&&o&&o.getValue("adminCount")>0},listToJSON:function(){var t=this;return this.list.map((function(e){var o=e.toJSON(),i=t.getInvitationModelForGroup(e.getValue("id"));return o.isGroup=!0,o.canRemove=t.canViewerRemove(e),i?(o.isInvitation=!0,o.invitedBy=i.getValue("invitedBy"),o.invitedByViewer=i.getValue("invitedBy")===t.appContext.getViewer().nsid,o.invitedByViewer||(o.truncateTitle=!0)):(o.isInvitation=!1,o.url=o.group.url),o}))},buildContainer:function(){var e=this.get("photoGroupInvitationsModel")?this.get("photoGroupInvitationsModel").getValue("total"):0,o=this.get("photoGroupsModel").getValue("total"),i=e+o>this.displayAmount,n=this.canViewerAdd(),s=this.canViewerInvite(),a=this.appContext.getViewer().nsid,r=this.get("photoModel").getValue("owner").getValue("id")===a;let l=r&&(3!==this.get("photoPrivacyModel").getValue("permComment")||3!==this.get("photoPrivacyModel").getValue("permAddMeta"));this.setContainerWithTemplate("sub-photo-contexts-groups",{empty:0===this.list.length,canAdd:n,canInvite:s,canAddOrInvite:n||s,contexts:this.listToJSON(),showMore:i,totalGroups:o,totalInvitations:e,totalInvitationsFriendly:t.Number.format(e,{thousandsSeparator:","}),viewerIsOwner:r,showPrivacyInfoLabel:l})},activate:function(){var t=this,e=this.get("container");return(this.canViewerAdd()||this.canViewerInvite())&&(this.get("photoGroupInvitationsModel")&&this.registerEventHandler(this.get("photoGroupInvitationsModel").on("valuesChanged",this.handleListChanges.bind(this))),this.get("photoGroupsModel")&&this.registerEventHandler(this.get("photoGroupsModel").on("valuesChanged",this.handleListChanges.bind(this))),this.attachKeyEvent(this.addKeyShortcut,(function(e){e.preventDefault(),t.showAddDialog()}))),this.registerEventHandler(e.on("click",this.handleContainerClick.bind(this))),this.jumpToPermalink(),this},handleListChanges:function(t){this.loading||this.reload()},handleContainerClick:function(e){var i;if(e.target.ancestor(".remove",!0)||e.target.ancestor(".cancel-invite",!0))e.preventDefault(),i=e.target.ancestor("li"),this.removeFromContext(i.getAttribute("data-context-id"),i),t.Snowplough.sendStructuredEvent({category:"photopageinteractions",action:"removeFromGroupClick",label:i.getAttribute("data-context-id")},t.Snowplough.getPhotoContextFromModel(this.get("photoModel")));else if(e.target.ancestor(".accept-invite",!0))e.preventDefault(),i=e.target.ancestor("li"),this.acceptInvitation(i.getAttribute("data-context-id"),i),t.Snowplough.sendStructuredEvent({category:"photopageinteractions",action:"acceptGroupInviteClick"},t.Snowplough.getPhotoContextFromModel(this.get("photoModel")));else if(e.target.ancestor(".add-to",!0))e.preventDefault(),this.showAddDialog(),t.Snowplough.sendStructuredEvent({category:"photopageinteractions",action:"addToGroupClick"},t.Snowplough.getPhotoContextFromModel(this.get("photoModel")));else if(e.target.ancestor(".view-all-contexts-of-type a",!0))e.preventDefault(),this.showMore(),t.Snowplough.sendStructuredEvent({category:"photopageinteractions",action:"viewMoreGroupsClick"});else if(e.target.ancestor(".group-privacy-info-icon",!0))this.handleTooltipClick();else if(e.target&&"A"===e.target.getDOMNode().tagName)try{let o=e.target.ancestor("ul").get("children").indexOf(e.target.ancestor("li"));t.Snowplough.sendStructuredEvent({category:"photopageinteractions",action:"groupClick",value:o+1},t.Snowplough.getPhotoContextFromModel(this.get("photoModel")))}catch(t){o.error(t)}},showMore:function(){this.displayAmount===this.startAmount&&this.startAmount<this.perPage?this.displayAmount=this.perPage:this.displayAmount+=this.perPage,this.setViewDataOnHistory("displayAmount",this.displayAmount),this.reload()},reload:function(){var t=this;this.loadListData().then((function(e){e.listChanged&&t.buildContainer()}))},removeFromContext:function(t,e){var o,i,n=this,s=!!this.getInvitationModelForGroup(t),a=this.appContext.getViewer().nsid,r=this.get("photoModel").getValue("owner").getValue("id"),l={photoID:this.photoId,groupID:t};this.removing[t]||(this.removing[t]=!0,e.setStyle("opacity","0"),s?(r===a?(o="photo-group-invitations-models",i="declineInvitation",l.userID=r):(o="group-pool-models",i="cancelPhotoInvitation"),this.get("photoGroupInvitationsModel")):(o="group-pool-models",i="removePhoto",this.get("photoGroupsModel")),this.appContext.getModelRegistry(o).then((function(o){o.remote[i](l,n.appContext).then((function(e){delete n.removing[t],n.reload()}),(function(o){throw delete n.removing[t],e.setStyle("opacity","1"),o})).then(null,(function(t){throw n.onError({message:n.intlMessage({intlName:"photo-page-scrappy.ERROR_REMOVING_FROM_GROUP"}),err:t}),t}))})))},acceptInvitation:function(t,e){var o=this,i={userID:this.appContext.getViewer().nsid,photoID:this.photoId,groupID:t};this.accepting[t]||(this.accepting[t]=!0,this.appContext.getModelRegistry("photo-group-invitations-models").then((function(e){return e.remote.acceptInvitation(i,o.appContext).then((function(){delete o.accepting[t],o.wasInvitation.push(t),o.reload()}),(function(e){throw delete o.accepting[t],e})).then(null,(function(t){throw o.onError({message:o.intlMessage({intlName:"photo-page-scrappy.ERROR_ACCEPTING_INVITATION"}),err:t}),t}))})))},showAddDialog:function(){this.showAddToStuff()},showAddToStuff:function(){var e=this.get("photoModel").getValue("isOwner");new t.CurationHelper(this.appContext,{view:this}).showAddToCuration({photoId:this.get("photoModel").getValue("id"),showAlbums:e,showGalleries:!e,initialTab:"group",useViewportType:!1,containerType:"modal",modalSizeConfig:{selectionConfig:{height:450,flexLayout:!0},creationConfig:{height:"auto",flexLayout:!1}}})},jumpToPermalink:function(){var e=t.config.win.location.hash,o=this.get("container");"#sub-photo-groups-section"===e&&t.AnchorRepositioner.jumpTo(o)},handleTooltipClick:function(){var e=this.get("container").one(".group-privacy-info-icon");new t.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,dismissOnOverlayClick:!0,width:300,anchorElement:e,preferBottom:!0,htmlMessage:this.intlMessage({intlName:"photo-page-scrappy.GROUPS_PRIVACY_INFO_WARNING"})}).show()},onError:function(e){var o=this;new t.Views.FluidModal({title:o.intlMessage({intlName:"common.ERROR"}),actionButtonLabel:o.intlMessage({intlName:"common.OK"}),textMessage:e.message,appContext:o.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelButton:!1,showCancelX:!0}).show()}})}),"@VERSION@",{requires:["array-extras","flickr-view","fluid-modal-view","flickr-promise","hermes-template-sub-photo-contexts-item","hermes-template-sub-photo-contexts-title-groups","hermes-template-sub-photo-contexts-groups","url-helper","add-to-stuff-view","curation-helper"],optional:["photo-group-invitations-models","photo-groups-models","photo-models","person-groups-models","group-pool-models"],langBundles:["more-menu-view","photo-page-scrappy","common"]});YUI.add("hermes-template-sub-photo-contexts-title-albums",(function(n,e){var t=n.Template.Handlebars.revive({1:function(n,e,t,l,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t"+n.escapeExpression((a(t,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{count:null!=e?a(e,"totalFriendly"):e,intlName:"photo-page-scrappy.ALBUMS_COUNT"},data:o,loc:{start:{line:3,column:2},end:{line:3,column:80}}}))+"\n"},3:function(n,e,t,l,o){var a,r=null!=e?e:n.nullContext||{},s=n.hooks.helperMissing,i=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return(null!=(a=(i(t,"ifCond")||e&&i(e,"ifCond")||s).call(r,null!=e?i(e,"total"):e,"===",1,{name:"ifCond",hash:{},fn:n.program(4,o,0),inverse:n.noop,data:o,loc:{start:{line:5,column:2},end:{line:7,column:13}}}))?a:"")+(null!=(a=(i(t,"ifCond")||e&&i(e,"ifCond")||s).call(r,null!=e?i(e,"total"):e,">",1,{name:"ifCond",hash:{},fn:n.program(6,o,0),inverse:n.noop,data:o,loc:{start:{line:8,column:2},end:{line:10,column:13}}}))?a:"")},4:function(n,e,t,l,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t\t"+n.escapeExpression((a(t,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PHOTO_IN_ONE_ALBUM"},data:o,loc:{start:{line:6,column:3},end:{line:6,column:67}}}))+"\n"},6:function(n,e,t,l,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t\t"+n.escapeExpression((a(t,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{count:null!=e?a(e,"totalFriendly"):e,intlName:"photo-page-scrappy.PHOTO_IN_N_ALBUMS"},data:o,loc:{start:{line:9,column:3},end:{line:9,column:86}}}))+"\n"},compiler:[8,">= 4.3.0"],main:function(n,e,t,l,o){var a,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'<h5 class="total" tabindex="0">\n'+(null!=(a=r(t,"if").call(null!=e?e:n.nullContext||{},null!=e?r(e,"isMobile"):e,{name:"if",hash:{},fn:n.program(1,o,0),inverse:n.program(3,o,0),data:o,loc:{start:{line:2,column:1},end:{line:11,column:8}}}))?a:"")+"</h5>\n"},useData:!0}),l={};n.Array.each([],(function(e){var t=n.Template.get("hermes/"+e);t&&(l[e]=t)})),n.Template.register("hermes/sub-photo-contexts-title-albums",(function(e,o){return(o=o||{}).partials=o.partials?n.merge(l,o.partials):l,t(e,o)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-sub-photo-contexts-albums",(function(t,e){var n=t.Template.Handlebars.revive({1:function(t,e,n,l,o){var a,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(a=r(n,"if").call(null!=e?e:t.nullContext||{},null!=e?r(e,"canAdd"):e,{name:"if",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:1},end:{line:7,column:8}}}))?a:""},2:function(t,e,n,l,o){var a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,s=t.escapeExpression,i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\t\t<div class="sub-photo-context sub-photo-context-albums empty">\n\t\t\t<p tabindex="0">'+s((i(n,"intlMessage")||e&&i(e,"intlMessage")||r).call(a,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PHOTO_NOT_IN_ALBUMS"},data:o,loc:{start:{line:4,column:19},end:{line:4,column:84}}}))+"</p>\n\t\t\t<p><a href='#' class='add-to'>"+s((i(n,"intlMessage")||e&&i(e,"intlMessage")||r).call(a,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_TO_ALBUM"},data:o,loc:{start:{line:5,column:33},end:{line:5,column:91}}}))+"</a></p>\n\t\t</div>\n"},4:function(t,e,n,l,o){var a,r=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\t<div class="sub-photo-context sub-photo-context-albums">\n'+(null!=(a=t.invokePartial(s(l,"sub-photo-contexts-title-albums"),e,{name:"sub-photo-contexts-title-albums",data:o,indent:"\t\t",helpers:n,partials:l,decorators:t.decorators}))?a:"")+(null!=(a=s(n,"if").call(r,null!=e?s(e,"canAdd"):e,{name:"if",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:11,column:2},end:{line:13,column:9}}}))?a:"")+'\t\t<ul class="context-list">\n'+(null!=(a=s(n,"each").call(r,null!=e?s(e,"contexts"):e,{name:"each",hash:{},fn:t.program(7,o,0),inverse:t.noop,data:o,loc:{start:{line:15,column:3},end:{line:17,column:12}}}))?a:"")+"\t\t</ul>\n"+(null!=(a=s(n,"if").call(r,null!=e?s(e,"showMore"):e,{name:"if",hash:{},fn:t.program(9,o,0),inverse:t.noop,data:o,loc:{start:{line:19,column:2},end:{line:21,column:9}}}))?a:"")+"\t</div>\n"},5:function(t,e,n,l,o){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"\t\t\t<a href='#' class='add-to'>"+t.escapeExpression((a(n,"intlMessage")||e&&a(e,"intlMessage")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_TO_ALBUM"},data:o,loc:{start:{line:12,column:30},end:{line:12,column:88}}}))+"</a>\n"},7:function(t,e,n,l,o){var a,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(a=t.invokePartial(r(l,"sub-photo-contexts-item"),e,{name:"sub-photo-contexts-item",data:o,indent:"\t\t\t\t",helpers:n,partials:l,decorators:t.decorators}))?a:""},9:function(t,e,n,l,o){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\t\t\t<div class="view-all-contexts-of-type"><a href="#">'+t.escapeExpression((a(n,"intlMessage")||e&&a(e,"intlMessage")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.VIEW_MORE_ALBUMS"},data:o,loc:{start:{line:20,column:54},end:{line:20,column:116}}}))+"</a></div>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,l,o){var a,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(a=r(n,"if").call(null!=e?e:t.nullContext||{},null!=e?r(e,"empty"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(4,o,0),data:o,loc:{start:{line:1,column:0},end:{line:23,column:7}}}))?a:""},usePartial:!0,useData:!0}),l={};t.Array.each(["sub-photo-contexts-title-albums","sub-photo-contexts-item"],(function(e){var n=t.Template.get("hermes/"+e);n&&(l[e]=n)})),t.Template.register("hermes/sub-photo-contexts-albums",(function(e,o){return(o=o||{}).partials=o.partials?t.merge(l,o.partials):l,n(e,o)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-sub-photo-contexts-title-albums","hermes-template-sub-photo-contexts-item"]});YUI.add("sub-photo-albums-view",(function(t,e){var o=require("hermes-core/flog")(e);t.FlickrView.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.photoId=t.photoId,this.list=[],this.loading=!1,this.removing={},this.startAmount=6,this.perPage=50,this.displayAmount=this.startAmount,this.addKeyShortcut="down:65,69",void 0!==this.getViewDataFromHistory("displayAmount")&&(this.startAmount=this.getViewDataFromHistory("displayAmount"),this.displayAmount=this.getViewDataFromHistory("displayAmount")),""===this.get("container").get("innerHTML")&&this.setContainerHTML("")},loadState:function(){var e,o=this;return e={photoSetsModel:this.appContext.getModel("photo-sets-models",this.photoId),photoModel:this.appContext.getModel("photo-models",this.photoId)},this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===this._params.nsid&&(e.personSetsModel=this.appContext.getModel("sets-models",this.appContext.getViewer().nsid,{page:1,perPage:this.appContext.flipper.isFlipped("enable-sets-list-loading-fix")?10:500})),new t.FlickrPromise(e).then((function(e){return t.Object.each(e,(function(t,e){o.set(e,t)})),o.loadListData()}))},loadListData:function(){var e=this;return this.loading=!0,this.getSets(this.displayAmount).then((function(o){var i,n,s,a,r=e.list,l=[];return e.loading=!1,(l=o||[]).length>e.displayAmount&&(l=l.slice(0,e.displayAmount)),(n=r)===(s=l)||n.length===s.length&&(a=!0,t.Array.some(n,(function(t,e){if(t!==s[e])return a=!1,!0})),a)?i=!1:(e.list=l,i=!0),{listChanged:i}}))},getSets:function(e){var o=this.get("photoSetsModel"),i=o.getValue("sets").getList(),n=o.getValue("total");return e>n&&(e=n),i.length<e?o.getListPageByContinuation(e-i.length).then((function(){return o.getValue("sets").getList().slice(0,e)})):t.Promise.resolve(i.slice(0,e))},canViewerRemove:function(t){return this.appContext.getViewer().nsid===this._params.nsid},canViewerAdd:function(){return this.appContext.getViewer().nsid===this._params.nsid},listToJSON:function(){var t=this;return this.list.map((function(e){var o=e.toJSON();return o.isSet=!0,o.canRemove=t.canViewerRemove(e),o}))},buildContainer:function(){var e=this.get("photoSetsModel").getValue("total"),o=e>this.displayAmount;this.setContainerWithTemplate("sub-photo-contexts-albums",{empty:0===this.list.length,canAdd:this.canViewerAdd(),contexts:this.listToJSON(),showMore:o,total:e,totalFriendly:t.Number.format(e,{thousandsSeparator:","})})},activate:function(){var t=this,e=this.get("container");return this.canViewerAdd()&&(this.get("photoSetsModel")&&this.registerEventHandler(this.get("photoSetsModel").on("valuesChanged",this.handleListChanges.bind(this))),this.attachKeyEvent(this.addKeyShortcut,(function(e){e.preventDefault(),t.showAddDialog()}))),this.registerEventHandler(e.on("click",this.handleContainerClick.bind(this))),this},handleListChanges:function(t){this.loading||this.reload()},handleContainerClick:function(e){var i,n,s=this;if(e.target.ancestor(".remove",!0))e.preventDefault(),i=e.target.ancestor("li"),n=i.getAttribute("data-context-id"),this.appContext.getModel("set-models",n).then((function(t){1===t.getValue("photoCount")+t.getValue("videoCount")?s.confirmDeleteAlbum(t).then((function(){s.removeFromContext(n,i)}),(function(t){o.error("error opening the album deletion warning modal",{err:t})})):s.removeFromContext(n,i)})),t.Snowplough.sendStructuredEvent({category:"photopageinteractions",action:"removeFromAlbumClick",label:n},t.Snowplough.getPhotoContextFromModel(s.get("photoModel")));else if(e.target.ancestor(".add-to",!0))e.preventDefault(),this.showAddDialog(),t.Snowplough.sendStructuredEvent({category:"photopageinteractions",action:"addToAlbumsClick"},t.Snowplough.getPhotoContextFromModel(s.get("photoModel")));else if(e.target.ancestor(".view-all-contexts-of-type a",!0))e.preventDefault(),this.showMore(),t.Snowplough.sendStructuredEvent({category:"photopageinteractions",action:"viewMoreAlbumsClick"},t.Snowplough.getPhotoContextFromModel(s.get("photoModel")));else if(e.target&&"A"===e.target.getDOMNode().tagName)try{let o=e.target.ancestor("ul").get("children").indexOf(e.target.ancestor("li"));t.Snowplough.sendStructuredEvent({category:"photopageinteractions",action:"albumClick",value:o+1},t.Snowplough.getPhotoContextFromModel(s.get("photoModel")))}catch(t){o.error(t)}},showMore:function(){this.displayAmount===this.startAmount&&this.startAmount<this.perPage?this.displayAmount=this.perPage:this.displayAmount+=this.perPage,this.setViewDataOnHistory("displayAmount",this.displayAmount),this.reload()},reload:function(){var t=this;this.loadListData().then((function(e){e.listChanged&&t.buildContainer()}))},removeFromContext:function(t,e){var o=this,i={photoID:this.photoId,setID:t};this.removing[t]||(this.removing[t]=!0,e.setStyle("opacity","0"),"set-models","removePhoto",this.get("photoSetsModel"),this.appContext.getModelRegistry("set-models").then((function(n){n.remote.removePhoto(i,o.appContext).then((function(e){delete o.removing[t],o.reload()}),(function(i){throw delete o.removing[t],e.setStyle("opacity","1"),i})).then(null,(function(t){throw o.onError({message:this.intlMessage({intlName:"photo-page-scrappy.ERROR_REMOVING_FROM_ALBUM"}),err:t}),t}))})))},confirmDeleteAlbum:function(e){var o=this;return new t.Promise((function(e,i){var n;(n=new t.Views.FluidModal({title:o.intlMessage({intlName:"common.CONFIRMATION"}),actionButtonLabel:o.intlMessage({intlName:"photo-page-scrappy.REMOVE_PHOTO_AND_ALBUM"}),htmlMessage:o.intlMessage({intlName:"photo-page-scrappy.WARNING_REMOVE_LAST_PHOTO_FROM_ALBUM"}),appContext:o.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelButton:!0,showCancelX:!0})).on("actionClick",(function(t){e(),o.appContext.flapp.get("activeView").backToURL="",o.appContext.flapp.navigate(o.get("photoModel").getValue("url"))})),n.on("cancelClick",(function(t){i()})),n.show()}))},showAddDialog:function(){this.showAddToStuff()},showAddToStuff:function(){new t.CurationHelper(this.appContext,{view:this}).showAddToCuration({photoId:this.photoId,showAlbums:!0,showGalleries:!1,initialTab:"album",useViewportType:!1,containerType:"modal",modalSizeConfig:{selectionConfig:{height:450,flexLayout:!0},creationConfig:{height:"auto",flexLayout:!1}}})},onError:function(e){new t.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.ERROR"}),htmlMessage:e.message,actionButtonLabel:this.intlMessage({intlName:"common.OK"}),showCancelButton:!1,showActionButton:!1,showFooter:!1,dismissOnOverlayClick:!0}).show()}})}),"@VERSION@",{requires:["array-extras","flickr-view","flickr-promise","hermes-template-sub-photo-contexts-item","hermes-template-sub-photo-contexts-title-albums","hermes-template-sub-photo-contexts-albums","url-helper","fluid-modal-view","add-to-stuff-view","curation-helper"],optionalRequires:["hermes-core"],optional:["photo-sets-models","photo-models","sets-models"],langBundles:["more-menu-view","groups","photo-page-scrappy","common"]});YUI.add("hermes-template-sub-photo-contexts-title-galleries",(function(n,e){var l=n.Template.Handlebars.revive({1:function(n,e,l,t,o){var a,r=null!=e?e:n.nullContext||{},i=n.hooks.helperMissing,s=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return(null!=(a=(s(l,"ifCond")||e&&s(e,"ifCond")||i).call(r,null!=e?s(e,"total"):e,"!==",0,{name:"ifCond",hash:{},fn:n.program(2,o,0),inverse:n.noop,data:o,loc:{start:{line:3,column:2},end:{line:5,column:13}}}))?a:"")+(null!=(a=(s(l,"ifCond")||e&&s(e,"ifCond")||i).call(r,null!=e?s(e,"total"):e,"===",0,{name:"ifCond",hash:{},fn:n.program(4,o,0),inverse:n.noop,data:o,loc:{start:{line:6,column:2},end:{line:8,column:13}}}))?a:"")},2:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t\t"+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{count:null!=e?a(e,"totalFriendly"):e,intlName:"photo-page-scrappy.GALLERIES_COUNT"},data:o,loc:{start:{line:4,column:3},end:{line:4,column:84}}}))+"\n"},4:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t\t"+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"common.GALLERIES"},data:o,loc:{start:{line:7,column:3},end:{line:7,column:46}}}))+"\n"},6:function(n,e,l,t,o){var a,r=null!=e?e:n.nullContext||{},i=n.hooks.helperMissing,s=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return(null!=(a=(s(l,"ifCond")||e&&s(e,"ifCond")||i).call(r,null!=e?s(e,"total"):e,"===",1,{name:"ifCond",hash:{},fn:n.program(7,o,0),inverse:n.noop,data:o,loc:{start:{line:10,column:2},end:{line:12,column:13}}}))?a:"")+(null!=(a=(s(l,"ifCond")||e&&s(e,"ifCond")||i).call(r,null!=e?s(e,"total"):e,">",1,{name:"ifCond",hash:{},fn:n.program(9,o,0),inverse:n.noop,data:o,loc:{start:{line:13,column:2},end:{line:15,column:13}}}))?a:"")+(null!=(a=(s(l,"ifCond")||e&&s(e,"ifCond")||i).call(r,null!=e?s(e,"total"):e,"===",0,{name:"ifCond",hash:{},fn:n.program(4,o,0),inverse:n.noop,data:o,loc:{start:{line:16,column:2},end:{line:18,column:13}}}))?a:"")},7:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t\t"+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PHOTO_IN_ONE_GALLERY"},data:o,loc:{start:{line:11,column:3},end:{line:11,column:69}}}))+"\n"},9:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t\t"+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{count:null!=e?a(e,"totalFriendly"):e,intlName:"photo-page-scrappy.PHOTO_IN_N_GALLERIES"},data:o,loc:{start:{line:14,column:3},end:{line:14,column:89}}}))+"\n"},compiler:[8,">= 4.3.0"],main:function(n,e,l,t,o){var a,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'<h5 class="total">\n'+(null!=(a=r(l,"if").call(null!=e?e:n.nullContext||{},null!=e?r(e,"isMobile"):e,{name:"if",hash:{},fn:n.program(1,o,0),inverse:n.program(6,o,0),data:o,loc:{start:{line:2,column:1},end:{line:19,column:8}}}))?a:"")+"</h5>"},useData:!0}),t={};n.Array.each([],(function(e){var l=n.Template.get("hermes/"+e);l&&(t[e]=l)})),n.Template.register("hermes/sub-photo-contexts-title-galleries",(function(e,o){return(o=o||{}).partials=o.partials?n.merge(t,o.partials):t,l(e,o)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});