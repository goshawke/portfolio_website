YUI.add("hermes-template-sub-photo-person",(function(n,l){var t=n.Template.Handlebars.revive({1:function(n,l,t,e,a){var o,r,s=null!=l?l:n.nullContext||{},i=n.hooks.helperMissing,c="function",u=n.escapeExpression,p=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t<li class="tag '+(null!=(o=p(t,"if").call(s,null!=l?p(l,"showRemove"):l,{name:"if",hash:{},fn:n.program(2,a,0),inverse:n.noop,data:a,loc:{start:{line:2,column:16},end:{line:2,column:55}}}))?o:"")+" "+(null!=(o=p(t,"if").call(s,null!=l?p(l,"isSuggestedTag"):l,{name:"if",hash:{},fn:n.program(4,a,0),inverse:n.noop,data:a,loc:{start:{line:2,column:56},end:{line:2,column:110}}}))?o:"")+'" data-tag-id="'+u(typeof(r=null!=(r=p(t,"nsid")||(null!=l?p(l,"nsid"):l))?r:i)===c?r.call(s,{name:"nsid",hash:{},data:a,loc:{start:{line:2,column:125},end:{line:2,column:133}}}):r)+'" data-value="'+u(typeof(r=null!=(r=p(t,"username")||(null!=l?p(l,"username"):l))?r:i)===c?r.call(s,{name:"username",hash:{},data:a,loc:{start:{line:2,column:147},end:{line:2,column:159}}}):r)+'">\n\t\t<div class="tag-content-container">\n\t\t\t<div class="tag-content">\n\t\t\t\t<div class="circle-icon" data-person-nsid="'+u(typeof(r=null!=(r=p(t,"nsid")||(null!=l?p(l,"nsid"):l))?r:i)===c?r.call(s,{name:"nsid",hash:{},data:a,loc:{start:{line:5,column:47},end:{line:5,column:55}}}):r)+'">\n\t\t\t\t\t<a tabindex="-1" href="/photos/'+u(typeof(r=null!=(r=p(t,"pathAlias")||(null!=l?p(l,"pathAlias"):l))?r:i)===c?r.call(s,{name:"pathAlias",hash:{},data:a,loc:{start:{line:6,column:36},end:{line:6,column:49}}}):r)+'/" class="add-people-avatar">\n\t\t\t\t\t\t<img class="show-person-menu" src="'+(null!=(o=p(t,"if").call(s,null!=(o=null!=l?p(l,"buddyicon"):l)?p(o,"default"):o,{name:"if",hash:{},fn:n.program(6,a,0),inverse:n.program(8,a,0),data:a,loc:{start:{line:7,column:41},end:{line:7,column:115}}}))?o:"")+'" width="32" height="32">\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t<div class="name-info">\n\t\t\t\t\t<span class="person-name">\n\t\t\t\t\t\t'+u(typeof(r=null!=(r=p(t,"displayname")||(null!=l?p(l,"displayname"):l))?r:i)===c?r.call(s,{name:"displayname",hash:{},data:a,loc:{start:{line:12,column:6},end:{line:12,column:21}}}):r)+(null!=(o=p(t,"if").call(s,null!=l?p(l,"isDeleted"):l,{name:"if",hash:{},fn:n.program(10,a,0),inverse:n.noop,data:a,loc:{start:{line:12,column:21},end:{line:12,column:94}}}))?o:"")+"\n\t\t\t\t\t\t"+(null!=(o=p(t,"if").call(s,null!=l?p(l,"isPro"):l,{name:"if",hash:{},fn:n.program(12,a,0),inverse:n.noop,data:a,loc:{start:{line:13,column:6},end:{line:13,column:92}}}))?o:"")+'\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="username">\n\t\t\t\t\t\t'+u(typeof(r=null!=(r=p(t,"username")||(null!=l?p(l,"username"):l))?r:i)===c?r.call(s,{name:"username",hash:{},data:a,loc:{start:{line:16,column:6},end:{line:16,column:18}}}):r)+'\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<svg class="icon icon-check_circle can-remove-tag"><use xlink:href="#icon-check_circle"></use></svg>\n'+(null!=(o=n.invokePartial(p(e,"flickr-balls"),l,{name:"flickr-balls",data:a,indent:"\t\t\t",helpers:t,partials:e,decorators:n.decorators}))?o:"")+"\t\t</div>\n\t</li>\n"},2:function(n,l,t,e,a){return"can-remove-tag"},4:function(n,l,t,e,a){return"can-remove-tag deselected"},6:function(n,l,t,e,a){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return n.escapeExpression(n.lambda(null!=(o=null!=l?r(l,"buddyicon"):l)?r(o,"default"):o,l))},8:function(n,l,t,e,a){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return n.escapeExpression("function"==typeof(o=null!=(o=r(t,"buddyicon")||(null!=l?r(l,"buddyicon"):l))?o:n.hooks.helperMissing)?o.call(null!=l?l:n.nullContext||{},{name:"buddyicon",hash:{},data:a,loc:{start:{line:7,column:95},end:{line:7,column:108}}}):o)},10:function(n,l,t,e,a){var o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return" ("+n.escapeExpression((o(t,"intlMessage")||l&&o(l,"intlMessage")||n.hooks.helperMissing).call(null!=l?l:n.nullContext||{},{name:"intlMessage",hash:{intlName:"common.DELETED_USER"},data:a,loc:{start:{line:12,column:40},end:{line:12,column:86}}}))+")"},12:function(n,l,t,e,a){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(o=n.invokePartial(r(e,"pro-badge"),l,{name:"pro-badge",hash:{purchaseProURL:null!=l?r(l,"purchaseProURL"):l,badgeType:null!=l?r(l,"proBadge"):l},data:a,helpers:t,partials:e,decorators:n.decorators}))?o:""},14:function(n,l,t,e,a){var o,r,s=null!=l?l:n.nullContext||{},i=n.hooks.helperMissing,c="function",u=n.escapeExpression,p=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t<li class="person hidden" '+(null!=(o=p(t,"if").call(s,null!=l?p(l,"dataAttr"):l,{name:"if",hash:{},fn:n.program(15,a,0),inverse:n.noop,data:a,loc:{start:{line:25,column:27},end:{line:25,column:92}}}))?o:"")+'>\n\t\t<div class="person-icon">\n\t\t\t<a class="'+u(typeof(r=null!=(r=p(t,"extraClasses")||(null!=l?p(l,"extraClasses"):l))?r:i)===c?r.call(s,{name:"extraClasses",hash:{},data:a,loc:{start:{line:27,column:13},end:{line:27,column:29}}}):r)+'" href="/photos/'+u(typeof(r=null!=(r=p(t,"pathAlias")||(null!=l?p(l,"pathAlias"):l))?r:i)===c?r.call(s,{name:"pathAlias",hash:{},data:a,loc:{start:{line:27,column:45},end:{line:27,column:58}}}):r)+'/" data-track="'+u(typeof(r=null!=(r=p(t,"dataTrackPrefix")||(null!=l?p(l,"dataTrackPrefix"):l))?r:i)===c?r.call(s,{name:"dataTrackPrefix",hash:{},data:a,loc:{start:{line:27,column:73},end:{line:27,column:92}}}):r)+'PersonIconClick">\n\t\t\t\t<div class="circle-icon" data-person-nsid="'+u(typeof(r=null!=(r=p(t,"nsid")||(null!=l?p(l,"nsid"):l))?r:i)===c?r.call(s,{name:"nsid",hash:{},data:a,loc:{start:{line:28,column:47},end:{line:28,column:55}}}):r)+'">\n\t\t\t\t\t<img class="show-person-menu" src="'+(null!=(o=p(t,"if").call(s,null!=(o=null!=l?p(l,"buddyicon"):l)?p(o,"default"):o,{name:"if",hash:{},fn:n.program(6,a,0),inverse:n.program(8,a,0),data:a,loc:{start:{line:29,column:40},end:{line:29,column:114}}}))?o:"")+'" width="32" height="32">\n\t\t\t\t</div>\n\t\t\t\t<span class="person-name">\n\t\t\t\t\t'+u(typeof(r=null!=(r=p(t,"displayname")||(null!=l?p(l,"displayname"):l))?r:i)===c?r.call(s,{name:"displayname",hash:{},data:a,loc:{start:{line:32,column:5},end:{line:32,column:20}}}):r)+(null!=(o=p(t,"if").call(s,null!=l?p(l,"isDeleted"):l,{name:"if",hash:{},fn:n.program(10,a,0),inverse:n.noop,data:a,loc:{start:{line:32,column:20},end:{line:32,column:93}}}))?o:"")+"\n\t\t\t\t</span>"+(null!=(o=p(t,"if").call(s,null!=l?p(l,"isPro"):l,{name:"if",hash:{},fn:n.program(12,a,0),inverse:n.noop,data:a,loc:{start:{line:33,column:11},end:{line:33,column:97}}}))?o:"")+"\n\t\t\t</a>\n\t\t</div>\n\t</li>\n"},15:function(n,l,t,e,a){var o,r=n.lambda,s=n.escapeExpression,i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"data-"+s(r(null!=(o=null!=l?i(l,"dataAttr"):l)?i(o,"key"):o,l))+'="'+s(r(null!=(o=null!=l?i(l,"dataAttr"):l)?i(o,"value"):o,l))+'"'},compiler:[8,">= 4.3.0"],main:function(n,l,t,e,a){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(o=r(t,"if").call(null!=l?l:n.nullContext||{},null!=l?r(l,"isAddPeopleModal"):l,{name:"if",hash:{},fn:n.program(1,a,0),inverse:n.program(14,a,0),data:a,loc:{start:{line:1,column:0},end:{line:37,column:7}}}))?o:""},usePartial:!0,useData:!0}),e={};n.Array.each(["pro-badge","flickr-balls","pro-badge"],(function(l){var t=n.Template.get("hermes/"+l);t&&(e[l]=t)})),n.Template.register("hermes/sub-photo-person",(function(l,a){return(a=a||{}).partials=a.partials?n.merge(e,a.partials):e,t(l,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-pro-badge","hermes-template-flickr-balls","hermes-template-pro-badge"]});YUI.add("hermes-template-invite-person",(function(e,n){var l=e.Template.Handlebars.revive({1:function(e,n,l,t,a){var i,r=e.lambda,o=e.escapeExpression,s=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return"data-"+o(r(null!=(i=null!=n?s(n,"dataAttr"):n)?s(i,"key"):i,n))+'="'+o(r(null!=(i=null!=n?s(n,"dataAttr"):n)?s(i,"value"):i,n))+'"'},3:function(e,n,l,t,a){return'\t\t<a class="remove-person hide-text ui-icon-comment-delete" href="#">x</a>\n'},compiler:[8,">= 4.3.0"],main:function(e,n,l,t,a){var i,r,o=null!=n?n:e.nullContext||{},s=e.hooks.helperMissing,c="function",u=e.escapeExpression,m=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'<li class="person" '+(null!=(i=m(l,"if").call(o,null!=n?m(n,"dataAttr"):n,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:1,column:19},end:{line:1,column:84}}}))?i:"")+'>\n\t<div class="person-icon">\n\t\t<div class="circle-icon">\n\t\t\t<img src="https://combo.staticflickr.com/pw/images/icon_unread.gif" width="'+u(typeof(r=null!=(r=m(l,"size")||(null!=n?m(n,"size"):n))?r:s)===c?r.call(o,{name:"size",hash:{},data:a,loc:{start:{line:4,column:78},end:{line:4,column:86}}}):r)+'" height="'+u(typeof(r=null!=(r=m(l,"size")||(null!=n?m(n,"size"):n))?r:s)===c?r.call(o,{name:"size",hash:{},data:a,loc:{start:{line:4,column:96},end:{line:4,column:104}}}):r)+'">\n\t\t</div>\n\t\t<p class="person-name">\n\t\t'+u(typeof(r=null!=(r=m(l,"email")||(null!=n?m(n,"email"):n))?r:s)===c?r.call(o,{name:"email",hash:{},data:a,loc:{start:{line:7,column:2},end:{line:7,column:11}}}):r)+"\n\t\t</p>\n"+(null!=(i=m(l,"if").call(o,null!=n?m(n,"showRemove"):n,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a,loc:{start:{line:9,column:2},end:{line:11,column:9}}}))?i:"")+"\t</div>\n</li>\n"},useData:!0}),t={};e.Array.each([],(function(n){var l=e.Template.get("hermes/"+n);l&&(t[n]=l)})),e.Template.register("hermes/invite-person",(function(n,a){return(a=a||{}).partials=a.partials?e.merge(t,a.partials):t,l(n,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-sub-photo-tags-people-section",(function(e,n){var t=e.Template.Handlebars.revive({1:function(e,n,t,l,o){var a,r=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(a=r(t,"if").call(null!=n?n:e.nullContext||{},null!=n?r(n,"emptyPeopleTags"):n,{name:"if",hash:{},fn:e.program(2,o,0),inverse:e.program(4,o,0),data:o,loc:{start:{line:4,column:1},end:{line:8,column:8}}}))?a:""},2:function(e,n,t,l,o){var a=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'\t\t<a href="#" class="show-add-people">'+e.escapeExpression((a(t,"intlMessage")||n&&a(n,"intlMessage")||e.hooks.helperMissing).call(null!=n?n:e.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_PEOPLE"},data:o,loc:{start:{line:5,column:38},end:{line:5,column:94}}}))+"</a>\n"},4:function(e,n,t,l,o){var a=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'\t\t<a href="#" class="show-add-people">'+e.escapeExpression((a(t,"intlMessage")||n&&a(n,"intlMessage")||e.hooks.helperMissing).call(null!=n?n:e.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.EDIT_PEOPLE"},data:o,loc:{start:{line:7,column:38},end:{line:7,column:95}}}))+"</a>\n"},6:function(e,n,t,l,o,a,r){var s,i=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(s=i(t,"if").call(null!=n?n:e.nullContext||{},null!=n?i(n,"person"):n,{name:"if",hash:{},fn:e.program(7,o,0,a,r),inverse:e.program(9,o,0,a,r),data:o,loc:{start:{line:13,column:2},end:{line:17,column:9}}}))?s:""},7:function(e,n,t,l,o,a,r){var s,i=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(s=e.invokePartial(i(l,"sub-photo-person"),null!=n?i(n,"person"):n,{name:"sub-photo-person",hash:{isAddPeopleModal:!1,purchaseProURL:null!=r[1]?i(r[1],"purchaseProURL"):r[1]},data:o,indent:"\t\t\t",helpers:t,partials:l,decorators:e.decorators}))?s:""},9:function(e,n,t,l,o){var a,r=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(a=e.invokePartial(r(l,"invite-person"),null!=n?r(n,"invite"):n,{name:"invite-person",data:o,indent:"\t\t\t",helpers:t,partials:l,decorators:e.decorators}))?a:""},11:function(e,n,t,l,o){var a=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'\t\t<div class="view-more"><a href="#">'+e.escapeExpression((a(t,"intlMessage")||n&&a(n,"intlMessage")||e.hooks.helperMissing).call(null!=n?n:e.nullContext||{},{name:"intlMessage",hash:{intlName:"common.VIEW_MORE"},data:o,loc:{start:{line:20,column:37},end:{line:20,column:80}}}))+"</a></div>\n"},compiler:[8,">= 4.3.0"],main:function(e,n,t,l,o,a,r){var s,i=null!=n?n:e.nullContext||{},p=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'<h3 tabindex="0">'+e.escapeExpression((p(t,"intlMessage")||n&&p(n,"intlMessage")||e.hooks.helperMissing).call(i,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PEOPLE_IN_PHOTO"},data:o,loc:{start:{line:1,column:17},end:{line:1,column:78}}}))+"</h3>\n\n"+(null!=(s=p(t,"if").call(i,null!=n?p(n,"canEditPeople"):n,{name:"if",hash:{},fn:e.program(1,o,0,a,r),inverse:e.noop,data:o,loc:{start:{line:3,column:0},end:{line:9,column:7}}}))?s:"")+'\n<div class="person-list">\n'+(null!=(s=p(t,"each").call(i,null!=n?p(n,"people"):n,{name:"each",hash:{},fn:e.program(6,o,0,a,r),inverse:e.noop,data:o,loc:{start:{line:12,column:1},end:{line:18,column:10}}}))?s:"")+(null!=(s=p(t,"if").call(i,null!=n?p(n,"showMore"):n,{name:"if",hash:{},fn:e.program(11,o,0,a,r),inverse:e.noop,data:o,loc:{start:{line:19,column:1},end:{line:21,column:8}}}))?s:"")+'</div>\n\n<div style="clear:both;"></div>\n'},usePartial:!0,useData:!0,useDepths:!0}),l={};e.Array.each(["sub-photo-person","invite-person"],(function(n){var t=e.Template.get("hermes/"+n);t&&(l[n]=t)})),e.Template.register("hermes/sub-photo-tags-people-section",(function(n,o){return(o=o||{}).partials=o.partials?e.merge(l,o.partials):l,t(n,o)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-sub-photo-person","hermes-template-invite-person"]});YUI.add("sub-photo-tags-people-view",(function(e,t){require("hermes-core/flog")(t);var s=new e.SubscriptionsHelper;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.photoId=t.photoId,this.context=e.clone(t.context,!0),this.startAmount=6,this.perPage=50,this.displayAmount=this.startAmount,void 0!==this.getViewDataFromHistory("displayAmount")&&(this.startAmount=this.getViewDataFromHistory("displayAmount"),this.displayAmount=this.getViewDataFromHistory("displayAmount")),""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this._css={locked:"ui-util-locked",working:"ui-util-working",removed:"ui-util-removed",shim:"c-contact-search-shim"},this},loadState:function(){var t=this;return new e.FlickrPromise({photo:this.appContext.getModel("photo-models",this.photoId),photoPeople:this.appContext.getModel("photo-people-models",this.photoId),peopleModel:this.appContext.getModelRegistry("person-in-photo-models"),person:this.appContext.getModelRegistry("person-models")}).then((function(e){t.set("photo",e.photo),t.set("photoPeople",e.photoPeople),t.set("peopleModel",e.peopleModel),t.set("person",e.person)})).then((function(){var e=t.appContext.getViewer();if(e.signedIn)return t.get("person").get(e.nsid).then((function(e){t.set("me",e)}))}))},buildContainer:function(){var e,t=this.get("photo"),o=this.get("photoPeople").getValue("people"),i=t.getValue("isOwner")||t.getValue("canAddMeta"),a=t.getValue("isOwner"),n=this,p=!1,r=!1,l=!1;return o&&(r=(e=o.toJSON()).length>this.displayAmount,0===e.length&&i?(p=!0,this.get("container").addClass("empty"),this.fire("subviewViewEvent","tagsPeopleView:peopleEmpty")):this.get("container").hasClass("empty")&&this.get("container").removeClass("empty"),e.forEach((function(e){e.person?(e.person.size=32,e.person.showRemove=n.canRemoveTag(a,n.appContext.getViewer().nsid,e.addedBy,e.person.nsid),e.person.dataAttr={key:"person-nsid",value:e.person.nsid},e.person.showRemove&&(l=!0)):(e.invite={size:32,email:e.email},e.invite.showRemove=n.canRemoveTag(a,n.appContext.getViewer().nsid,e.addedBy,null),e.invite.dataAttr={key:"person-tag-email",value:e.invite.email})})),e=e.sort((function(e,t){return e.invite&&t.person?-1:e.person&&t.invite?1:e.person&&t.person&&e.person.displayname.toUpperCase()<t.person.displayname.toUpperCase()?-1:e.person&&t.person&&e.person.displayname.toUpperCase()>t.person.displayname.toUpperCase()?1:e.invite&&t.invite&&e.invite.email&&t.invite.email&&e.invite.email.toUpperCase()<t.invite.email.toUpperCase()?-1:e.invite&&t.invite&&e.invite.email&&t.invite.email&&e.invite.email.toUpperCase()>t.invite.email.toUpperCase()?1:0}))),i||e.length>0?this.setContainerWithTemplate("sub-photo-tags-people-section",{people:e,canAddMeta:i,emptyPeopleTags:p,purchaseProURL:s.getProLandingPageUrl(s.UTM_PRO_BADGE,{utm_medium:this.name}),showMore:r,canEditPeople:i||l}):this.setContainerHTML(""),this},activate:function(){var t=this.get("container"),s=this,o=t.one(".person-list"),i=t.one(".view-more");return o&&o.all(".person, .hidden").slice(0,this.displayAmount).removeClass("hidden"),i&&this.registerEventHandler(i.on("click",(e=>{e.preventDefault(),this.showMore()}))),t.one(".show-add-people")&&(this.registerEventHandler(t.one(".show-add-people").on("click",(t=>{t.preventDefault(),this.showAddPeopleModal(),e.Snowplough.sendStructuredEvent({category:"photopageinteractions",action:"addPeopleClick"},e.Snowplough.getPhotoContextFromModel(this.get("photo")))}))),this.attachKeyEvent("down:80",(e=>{e.preventDefault();try{this.showAddPeopleModal()}catch(e){}}))),t.one(".person-list")&&this.registerEventHandler(t.one(".person-list").on("click",(function(t){t.target.ancestor("[data-loading]")?t.preventDefault():e.Snowplough.sendStructuredEvent({category:"photopageinteractions",action:"taggedPeopleClick"},e.Snowplough.getPhotoContextFromModel(s.get("photo")))}))),this},canRemoveTag:function(e,t,s,o){return e||t&&s===t||o&&o===t},onError:function(t,s){new e.Views.FluidModal({appContext:this.appContext,title:s||this.intlMessage({intlName:"common.OOPS"}),htmlMessage:t,actionButtonLabel:this.intlMessage({intlName:"common.OK"}),showCancelButton:!1}).show()},showMore:function(){this.displayAmount===this.startAmount&&this.startAmount<this.perPage?this.displayAmount=this.perPage:this.displayAmount+=this.perPage,this.setViewDataOnHistory("displayAmount",this.displayAmount);var e=this.get("container"),t=e.one(".view-more"),s=e.one(".person-list"),o=[];s&&((o=s.all(".person, .hidden")).slice(0,this.displayAmount).removeClass("hidden"),(o=o.slice(this.displayAmount)).isEmpty()&&t.hide())},showAddPeopleModal:function(){var t,s=this.get("photo"),o=s.getValue("isOwner")||s.getValue("canAddMeta");let i=new e.Views["sub-photo-add-tags-view"]({title:this.intlMessage({intlName:"photo-page-scrappy.ADD_PEOPLE"}),showCloseXButton:!0,photoId:this.photoId,isPersonTag:!0,placeholderText:this.intlMessage({intlName:"photo-page-scrappy.TYPE_A_NAME"}),url:"/people/me/contacts",urlText:this.intlMessage({intlName:"photo-page-scrappy.MANAGE_CONTACTS"}),emptyMessage:this.intlMessage({intlName:"photo-page-scrappy.NO_MEMBERS_FOUND"}),canAddMeta:o,disabledSearchPlaceholder:s.getValue("isVideo")?this.intlMessage({intlName:"photo-page-scrappy.YOU_CANNOT_ADD_PEOPLE_VIDEO"}):this.intlMessage({intlName:"photo-page-scrappy.YOU_CANNOT_ADD_PEOPLE_PHOTO"}),tagCount:this.get("photoPeople").getValue("people").getList().length,tagLimit:e.config.flickr.api.max_people_in_photo,onConfirm:async()=>{t.close()},loadTags:()=>{var t={},s=this.appContext.getViewer().nsid,i=this.appContext.getModel("contacts-models",s),a=this.get("photo").getValue("isOwner");this.contactList=[];var n=this.get("photoPeople")?this.get("photoPeople").getValue("people"):null,p={tag:[],additionalListClass:"removable-tags-list"},r={tag:[],additionalListClass:"nonremoveable-tags-list"};if(n&&(this.initialTagsMap=n.getList().map((e=>e.id))),n.toJSON().forEach((e=>{e.person.addedBy=e.addedBy,e.person.showRemove=this.canRemoveTag(a,this.appContext.getViewer().nsid,e.addedBy,e.person.nsid),e.person.showRemove?p.tag.push(e.person):r.tag.push(e.person)})),this.selectionLists={removeableTags:p,nonRemoveableTags:r,suggestedPeopleTags:{tag:[],additionalListClass:"suggested-people-list"}},o){var l=[];return l.push(this.appContext.callAPI("flickr.contacts.getList",{sort:"time",page:1,per_page:25})),l.push(i),e.Promise.all(l).then((s=>{var o=s[0].contacts.contact.slice(0),i=s[1],a=this.get("me").toJSON();return a.buddyicon=a.buddyicon?a.buddyicon.default:"",o.unshift(a),(o=o.filter((e=>-1===this.initialTagsMap.indexOf(e.nsid)))).forEach((t=>{t.realname=t.realname||t.username,t.displayname=t.realname||t.username,t.buddyicon=t.buddyicon||e.URLHelper.getBuddyIconURL(t.nsid,t.iconfarm,t.iconserver),t.isSuggestedTag=!0,t.pathAlias=t.pathAlias||t.nsid})),this.selectionLists.suggestedPeopleTags.tag=o,t.page=1,t.perPage=3e3,t.per_page=3e3,this.loadContacts(i,t)}),(e=>{this.onError()}))}return e.Promise.resolve(this.selectionLists)},addTag:t=>{var s=this.get("photoPeople")?this.get("photoPeople").getValue("people"):null;return e.Promise.resolve(this.get("peopleModel").remoteCreate({photoId:this.photoId,userId:t.tagId,addedBy:this.get("me").getValue("nsid"),coords:{x:0,y:0,w:0,h:0}}).then((e=>{var t=this.get("peopleModel").add(e),o=this.processPeopleTags([e.person]);return s&&s.appendToList(t),this.initialTagsMap=s.getList().map((e=>e.id)),o.tag[0]}),(e=>{var t=this.intlMessage({intlName:"photo-page-scrappy.PERSON_CANNOT_BE_TAGGED"}),s=this.intlMessage({intlName:"common.OOPS"});throw 8===e.code&&(t=this.intlMessage({intlName:"photo-page-scrappy.REACHED_MAX_PEOPLE_TAGS"}),s=this.intlMessage({intlName:"photo-page-scrappy.TAG_LIMIT_REACHED"})),this.onError(t,s),e})))},removeTag:t=>{var s=this.get("peopleModel"),o=this.get("photoPeople").getValue("people"),i=t,a={photoId:this.photoId,coords:{x:0,y:0,w:0,h:0}};return a.userId=i,e.Promise.resolve(s.remoteDelete(a).then((()=>{o.removeFromList(t,"id")}),(e=>{this.onError(this.intlMessage({intlName:"photo-page-scrappy.FAILED_TO_REMOVE_PERSON"}))})))},getSearchResults:(t,s)=>{var o=this.appContext.getViewer().nsid,i=this.appContext.getModel("contacts-models",o);return e.Promise.resolve(i.then((e=>e.search({username:t,page:s,perPage:20}).then((e=>({tags:this.processPeopleTags(e.people,!0).tag,pages:e.pages})),(e=>{this.onError()}))),(e=>{this.onError()})))},getContactResults:e=>{var t=[],s=0;for(const o of this.contactList)if((e.test(o.username)||e.test(o.realname)||e.test(o.email))&&(t.push(o),s++),s>=50)break;return t.filter((e=>!this.selectionLists.suggestedPeopleTags.tag.some((t=>t.nsid===e.nsid))))}});(t=new e.Views.FluidModal({appContext:this.appContext,subview:i,hasSubviewConfigRefactor:!0,flexLayout:!0,height:450}).show()).on("close",(()=>{this.detachRegisteredEvents(),this.buildContainer(),this.activate()}))},loadContacts:function(t,s){return e.Promise.resolve(t.getValue("contacts").getPage(s).then((e=>{var o=this.processPeopleTags(e,!1);return this.contactList=this.contactList.concat(o.tag),s.page<t.getValue("pages")?(s.page++,this.loadContacts(t,s)):this.selectionLists})))},processPeopleTags:function(t,s){var o={tag:[]};try{o.tag=t.map((e=>e.toJSON()))||[]}catch(e){o.tag=[]}return o.tag=o.tag.filter((e=>-1===this.initialTagsMap.indexOf(e.nsid))),s&&(o.tag=o.tag.filter((e=>!this.contactList.some((t=>t.nsid===e.nsid))&&!this.selectionLists.suggestedPeopleTags.tag.some((t=>t.nsid===e.nsid))))),o.tag.forEach((t=>{t.realname=t.realname||t.username,t.buddyicon=e.URLHelper.getBuddyIconURL(t.nsid,t.iconfarm,t.iconserver),t.isSuggestedTag=!0})),o}})}),"@VERSION@",{requires:["flickr-view","hermes-template-sub-photo-person","hermes-template-invite-person","hermes-template-sub-photo-tags-people-section","sub-photo-add-tags-view","url-helper","contact-search-box","html5-balls","subscriptions-helper"],optionalRequires:["hermes-core"],langBundles:["common","photo-page-scrappy"]});