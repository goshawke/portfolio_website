YUI.add("flickr-photosets-removePhoto-deletor",(function(e,t){"use strict";e.namespace("ModelCreators")["flickr-photosets-removePhoto"]={run:function(o,s){var l={full_response:1},i=[],u=o.isMultiplePhotos?"photo_ids":"photo_id",r=o.photoID.split(",").length;return l[u]=o.photoID,l.photoset_id=o.setID,o.includeHiddenSets&&(l.extras="hidden_sets",l.user_id=o.userId),i=[s.callAPI("flickr.photosets.removePhoto",l),s.getModel("set-models",o.setID),s.getModel("sets-models",s.getViewer().nsid,{page:1,perPage:s.flipper.isFlipped("enable-sets-list-loading-fix")||o.includeHiddenSets?10:500}),s.getModelRegistry("photo-sets-models"),s.getModelRegistry("photo-contexts-models")],o.isMultiplePhotos||i.push(s.getModel("photo-models",o.photoID)),e.Promise.all(i).then((function(e){var t,s=e[0],l=e[1],i=e[2],u=e[3],d=e[4];if("ok"===s.stat)return d.exists(o.photoID)&&d.getValue(o.photoID,"contexts").getFromListByID(o.setID)&&(d.setValue(o.photoID,"totalSets",d.getValue(o.photoID,"totalSets")-r),d.getValue(o.photoID,"contexts").removeFromList(o.setID)),u.exists(o.photoID)&&u.getValue(o.photoID,"sets").getFromListByID(o.setID)&&(u.setValue(o.photoID,"total",u.getValue(o.photoID,"total")-r),u.getValue(o.photoID,"sets").removeFromList(o.setID)),l&&(o.isMultiplePhotos?l&&o.updateItemCounts&&(l.setValue("photoCount",l.getValue("photoCount")-o.numberOfPhotosSelected),l.setValue("videoCount",l.getValue("videoCount")-o.numberOfVideosSelected)):(t=e[5],l.hasPhoto(t.getValue("id"))&&l.removePhoto(t),t.getValue("isVideo")?l.setValue("videoCount",l.getValue("videoCount")-r):l.setValue("photoCount",l.getValue("photoCount")-r)),l.getValue("totalCount")<1&&!o.includeHiddenSets)?(i.getValue("albumsList").remove(o.setID),l.registry.remove(o.setID),null):l}),e.FetcherErrorLogger(t))}}}),"@VERSION@",{requires:["flickr-promise"],optional:["set-models","photo-models","sets-models","photo-sets-models","photo-contexts-models"]});YUI.add("flickr-photosets-delete-deletor",(function(e,r){"use strict";e.namespace("ModelDeletors")["flickr-photosets-delete-deletor"]={run:function(o,t){return o.photoset_id=o.setID,o.gpCode&&(o.gp_code=o.gpCode),o.gpOwner&&(o.gp_owner=o.gpOwner),o.shareCode&&(o.share_code=o.shareCode),t.callAPI("flickr.photosets.delete",o).then((function(e){if(1===e.code)throw new Error(e)})).catch(e.FetcherErrorLogger(r))}}}),"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-photosets-getPhotos-fetcher",(function(e,o){"use strict";var t=require("hermes-core/flog")(o);e.namespace("ListFetchers")["flickr-photosets-getPhotos"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.photosets.getPhotos",this._processParams(t),!0),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("set-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models"),s.getModelRegistry("album-privacy-models")]).then((function(e){return r._processResponse(e,t)}),e.FetcherErrorLogger(o))},_processParams:function(o){o.page=o.page||1,o.perPage=o.perPage||100;var s={extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:o.perPage,page:o.page,get_user_info:1,primary_photo_extras:"url_c, url_h, url_k, url_l, url_m, url_n, url_o, url_q, url_s, url_sq, url_t, url_z, needs_interstitial, can_share",jump_to:o.withPhotoId||""};return o.gpCode&&null!==o.gpCode?(s.gp_code=o.gpCode,s.share_code=o.gpCode,s.gp_owner=o.gpOwner,t.info("Calling sets api with GP "+o.gpCode)):s.photoset_id=o.id.split("-")[0],o.includeHiddenSets&&(s.extras+=",hidden_sets",s.user_id=o.userId),o.viewAs&&(s.view_as=o.viewAs),o.filter&&(s.privacy_filter=o.filter),o.moderationFilter&&(s.moderation_filter=o.moderationFilter),s},_processResponse:function(o,t){var s,r,a,i,p,l=o[0],n=o[1],d=o[2],h=o[3],g=o[4],u=o[5],P=o[6],c=[],m=!1,_=!1,y=t.id;s=e.APIHelper.response.parsePerson(l.user),r=d.addOrUpdate(s);let f=l.photoset;a=e.APIHelper.response.parsePhotoset({...f,ownerModel:r}),y&&y!==l.photoset.id&&(a.id=y),"1"===l.photoset.isAutoUploadSet&&(a.canShare=!1),h.exists(t.id)&&(m=!!(i=h.getValue(t.id,"photoPageList")).hasMinBoundary&&i.hasMinBoundary(),_=!!i.hasMaxBoundary&&i.hasMaxBoundary(),c=i.getList()),p=e.APIHelper.response.parsePhotos({photos:l.photoset.photo,ownerID:l.photoset.owner,personModelRegistry:d,photoModelRegistry:n,photoEngagementModelRegistry:g,photoStatsModelRegistry:u}),a.photoPageList=e.APIHelper.response.addOrReplaceListByPage({current:c,perPage:t.perPage,pageNum:t.page,hasMax:_,hasMin:m,totalItems:l.photoset.total,newPages:p}),a.photoPageList={perPage:l.photoset.perPage,page:l.photoset.page,pageContent:p,totalItems:l.photoset.total};var M={id:a.id,countPhotosFamily:l.photoset.countPhotosFamily,countPhotosFriend:l.photoset.countPhotosFriend,countPhotosPublic:l.photoset.countPhotosPublic,countPhotosFriendFamily:l.photoset.countPhotosFriendFamily,totalCount:l.photoset.countPhotosAll};return P.exists(M.id)?P.setValues(t.id,M):P.add(M),h.exists(a.id)?h.setValue(t.id,"photoPageList",a.photoPageList):h.add(a),p}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optionalRequires:["hermes-core"],optional:["photo-models","person-models","set-models","photo-engagement-models","photo-stats-models"]});YUI.add("flickr-photosets-getContext-fetcher",(function(e,o){"use strict";e.namespace("ListFetchers")["flickr-photosets-getContext"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.photosets.getContext",this._processParams(t,s),!0),s.getModelRegistry("set-models"),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models")]).then((function(e){return r._processResponse(e,t)}),(function(e){throw 2===e.code&&"Photo not in set"===e.message&&(e.notInContext=!0),e})).then(null,e.FetcherErrorLogger(o))},_processParams:function(o,t){var s={extras:e.APIHelper.request.getRebootPhotoExtras(),photo_id:o.photoId,num_prev:o.numNext,num_next:o.numPrev,get_photoset_info:1};return o.gpCode?(s.share_code=o.gpCode,s.share_owner=o.gpOwner,s.gp_code=o.gpCode,s.gp_owner=o.gpOwner):s.photoset_id=o.id,s},_processResponse:function(o,t){var s,r,n,p,h,i,a,d,g=o[0],l=o[1],u=o[2],m=o[3],c=o[4],x=o[5],y=[],M=u.proxy(t.photoId);return r=g.prevphotos,n=g.nextphotos,s=e.APIHelper.response.parsePhotos({photos:r.photo,personModelRegistry:m,photoModelRegistry:u,photoEngagementModelRegistry:c,photoStatsModelRegistry:x}),y=e.APIHelper.response.parsePhotos({photos:n.photo,personModelRegistry:m,photoModelRegistry:u,photoEngagementModelRegistry:c,photoStatsModelRegistry:x}),p=!!(i=l.getValue(t.id,"photoContextList")).hasMinBoundary&&i.hasMinBoundary(),h=!!i.hasMaxBoundary&&i.hasMaxBoundary(),a=i.getList(),d=e.APIHelper.response.addOrReplaceListByContext({model:M,next:s,prev:y.reverse(),current:a,hasMin:p,hasMax:h,numNext:t.numNext,numPrev:t.numPrev}),l.setValue(t.id,"photoContextList",d),{next:s,previous:y.reverse()}}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","photo-engagement-models","photo-stats-models"]});YUI.add("flickr-photosets-create-creator",(function(e,t){"use strict";e.namespace("ModelCreators")["flickr-photosets-create"]={run:function(o,s){var l={},p=[];return l.title=o.title,l.description=o.description,l.primary_photo_id=o.photoID,l.full_result=1,s.flipper.isFlipped("enable-create-new-album-megamodal")&&o.sort&&(l.sort=o.sort),p=[s.callAPI("flickr.photosets.create",l),s.getModelRegistry("set-models"),s.getModel("person-models",s.getViewer().nsid),s.getModel("sets-models",s.getViewer().nsid,{page:1,perPage:s.flipper.isFlipped("enable-sets-list-loading-fix")?10:500}),s.getModelRegistry("photo-sets-models"),s.getModelRegistry("photo-contexts-models")],o.isMultiplePhotos||p.push(s.getModel("photo-models",o.photoID)),e.Promise.all(p).then((function(t){var s,l,p,i=t[0],r=t[1],a=t[2],d=t[3],h=t[4],n=t[5];if(i.photoset.id){o.isMultiplePhotos?o.numberOfPhotosSelected+o.numberOfVideosSelected===1?(i.photoset.photos,i.photoset.videos):i.photoset.photos?(i.photoset.photos,0):(i.photoset.videos,0):(l=t[6],i.photoset.photos,i.photoset.videos),s=e.APIHelper.response.parsePhotoset({...i.photoset,ownerModel:a,photoPageList:o.isMultiplePhotos?[]:[l],photoContextList:o.isMultiplePhotos?[]:[l]}),r.add(s),p=r.proxy(i.photoset.id);var u=d.getValue("albumsList").getList(),g=u.findIndex((e=>!e.getValue("isAutoUploadSet")));return g<0&&(g=0),u.splice(g,0,p),d.setValue("albumsList",u),h.exists(o.photoID)&&!h.getValue(o.photoID,"sets").getFromListByID(p.getValue("id"))&&(h.getValue(o.photoID,"sets").prependToList(p),h.setValue(o.photoID,"total",h.getValue(o.photoID,"total")+1)),n.exists(o.photoID)&&!n.getValue(o.photoID,"contexts").getFromListByID(p.getValue("id"))&&(n.setValue(o.photoID,"totalSets",n.getValue(o.photoID,"totalSets")+1),n.getValue(o.photoID,"contexts").appendToList(p)),p}return!1}),e.FetcherErrorLogger(t))}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","sets-models","photo-sets-models","photo-contexts-models"]});YUI.add("flickr-photosets-createHidden-creator",(function(e,o){"use strict";e.namespace("ModelCreators")["flickr-photosets-createHidden"]={run:function(t,s){var r,d={};return d.photo_ids=t.photoIds,r=[s.callAPI("flickr.photosets.createHidden",d),s.getModelRegistry("set-models"),s.getModel("person-models",s.getViewer().nsid)],e.Promise.all(r).then((function(e){var o,t=e[0],s=e[1],r=e[2];return!("ok"!==t.stat||!t.photoset.share_code)&&(o={id:t.photoset.share_code,shareCode:t.photoset.share_code,owner:r,gpCode:t.photoset.share_code,gpOwner:r.getValue("pathAlias")||r.getValue("nsid"),url:t.photoset.url,isAutoUploadSet:!1,isSharedEntity:!0,totalCount:t.photoset.count},s.add(o),s.proxy(o.id))}),e.FetcherErrorLogger(o))}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["set-models","photo-models","person-models","sets-models","photo-sets-models","photo-contexts-models"]});