YUI.add("hermes-template-gift-pro-success",(function(e,n){var a=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,n,a,t,l){var s,o=null!=n?n:e.nullContext||{},r=e.hooks.helperMissing,i=e.escapeExpression,c="function",p=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return"<h2>"+i((p(a,"intlMessage")||n&&p(n,"intlMessage")||r).call(o,{name:"intlMessage",hash:{intlName:"gift-pro.HOORAY"},data:l,loc:{start:{line:1,column:4},end:{line:1,column:46}}}))+"</h2>\n\n<p>"+i((p(a,"intlMessage")||n&&p(n,"intlMessage")||r).call(o,{name:"intlMessage",hash:{intlName:"gift-pro.YOU_JUST_BOUGHT_GIFT"},data:l,loc:{start:{line:3,column:3},end:{line:3,column:59}}}))+'</p>\n\n<div class="gifted-pro-container">\n\t<img class="gifted-pro" src="'+i(typeof(s=null!=(s=p(a,"assetRoot")||(null!=n?p(n,"assetRoot"):n))?s:r)===c?s.call(o,{name:"assetRoot",hash:{},data:l,loc:{start:{line:6,column:30},end:{line:6,column:43}}}):s)+'/images/pro/gifted-pro.png" srcset="'+i(typeof(s=null!=(s=p(a,"assetRoot")||(null!=n?p(n,"assetRoot"):n))?s:r)===c?s.call(o,{name:"assetRoot",hash:{},data:l,loc:{start:{line:6,column:79},end:{line:6,column:92}}}):s)+"/images/pro/gifted-pro.png 1x, "+i(typeof(s=null!=(s=p(a,"assetRoot")||(null!=n?p(n,"assetRoot"):n))?s:r)===c?s.call(o,{name:"assetRoot",hash:{},data:l,loc:{start:{line:6,column:123},end:{line:6,column:136}}}):s)+'/images/pro/gifted-pro@2x.png 2x"/>\n</div>\n\n<p>'+i((p(a,"preventOrphans")||n&&p(n,"preventOrphans")||r).call(o,(p(a,"intlMessage")||n&&p(n,"intlMessage")||r).call(o,{name:"intlMessage",hash:{name:null!=n?p(n,"recipientName"):n,intlName:"gift-pro.THANKS_FOR_GIVING"},data:l,loc:{start:{line:9,column:20},end:{line:9,column:90}}}),{name:"preventOrphans",hash:{},data:l,loc:{start:{line:9,column:3},end:{line:9,column:92}}}))+'</p>\n\n<p><a href="'+i(typeof(s=null!=(s=p(a,"photostreamURL")||(null!=n?p(n,"photostreamURL"):n))?s:r)===c?s.call(o,{name:"photostreamURL",hash:{},data:l,loc:{start:{line:11,column:12},end:{line:11,column:30}}}):s)+'">'+i(typeof(s=null!=(s=p(a,"photostreamURL")||(null!=n?p(n,"photostreamURL"):n))?s:r)===c?s.call(o,{name:"photostreamURL",hash:{},data:l,loc:{start:{line:11,column:32},end:{line:11,column:50}}}):s)+"</a></p>\n"},useData:!0}),t={};e.Array.each([],(function(n){var a=e.Template.get("hermes/"+n);a&&(t[n]=a)})),e.Template.register("hermes/gift-pro-success",(function(n,l){return(l=l||{}).partials=l.partials?e.merge(t,l.partials):t,a(n,l)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-gift-pro",(function(n,e){var t=n.Template.Handlebars.revive({1:function(n,e,t,l,a){var o=null!=e?e:n.nullContext||{},i=n.hooks.helperMissing,s=n.escapeExpression,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t<p class="gift-pro-container">\n\t\t<a href="?giftPro" class="gift-pro-link open-gift-modal">\n\t\t\t<svg class="icon icon-gift"><use xlink:href="#icon-gift"></use></svg>\n\t\t\t<span class="gift-pro-text" title="'+s((r(t,"intlMessage")||e&&r(e,"intlMessage")||i).call(o,{name:"intlMessage",hash:{intlName:"header.GIVE_PRO"},data:a,loc:{start:{line:5,column:38},end:{line:5,column:80}}}))+'">'+s((r(t,"intlMessage")||e&&r(e,"intlMessage")||i).call(o,{name:"intlMessage",hash:{intlName:"header.GIVE_PRO"},data:a,loc:{start:{line:5,column:82},end:{line:5,column:124}}}))+"</span>\n\t\t</a>\n\t</p>\n"},3:function(n,e,t,l,a){var o=null!=e?e:n.nullContext||{},i=n.hooks.helperMissing,s=n.escapeExpression,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t<p class="gift-pro-container">\n\t\t<a href="?giftPro" class="gift-pro-link open-gift-modal">\n\t\t\t<svg class="icon icon-gift"><use xlink:href="#icon-gift"></use></svg>\n\t\t\t<span class="gift-pro-text" title="'+s((r(t,"intlMessage")||e&&r(e,"intlMessage")||i).call(o,{name:"intlMessage",hash:{intlName:"header.GIVE_PRO"},data:a,loc:{start:{line:13,column:38},end:{line:13,column:80}}}))+'">'+s((r(t,"intlMessage")||e&&r(e,"intlMessage")||i).call(o,{name:"intlMessage",hash:{intlName:"header.DOWNLOAD_MODAL_SEND_GIFT"},data:a,loc:{start:{line:13,column:82},end:{line:13,column:140}}}))+"</span>\n\t\t</a>\n\t</p>\n"},5:function(n,e,t,l,a){var o=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t<div class="sub-photo-gift-user-container open-gift-modal">\n\t\t<svg class="icon icon-gift"><use xlink:href="#icon-gift"></use></svg>\n\t\t<a\thref="?giftPro" class="gift user gift-pro-link">'+n.escapeExpression((o(t,"intlMessage")||e&&o(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"checkout.SHOW_APPRECIATION_GIFT"},data:a,loc:{start:{line:20,column:53},end:{line:20,column:111}}}))+"</a>\n\t</div>\n"},7:function(n,e,t,l,a){var o=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t<div class="mobile-sub-photo-gift-user-container open-gift-modal">\n\t\t<svg class="icon icon-gift"><use xlink:href="#icon-gift"></use></svg>\n\t\t<a\thref="?giftPro" class="gift user gift-pro-link">'+n.escapeExpression((o(t,"intlMessage")||e&&o(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"checkout.SHOW_APPRECIATION_GIFT"},data:a,loc:{start:{line:26,column:53},end:{line:26,column:111}}}))+"</a>\n\t</div>\n"},9:function(n,e,t,l,a){var o=null!=e?e:n.nullContext||{},i=n.hooks.helperMissing,s=n.escapeExpression,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t<div href="?giftPro" class="gift-pro-container open-gift-modal">\n\t\t<svg class="icon icon-gift"><use xlink:href="#icon-gift"></use></svg>\n\t\t<div class="gift-pro-link" title="'+s((r(t,"intlMessage")||e&&r(e,"intlMessage")||i).call(o,{name:"intlMessage",hash:{intlName:"header.GIVE_PRO"},data:a,loc:{start:{line:32,column:36},end:{line:32,column:78}}}))+'">'+s((r(t,"intlMessage")||e&&r(e,"intlMessage")||i).call(o,{name:"intlMessage",hash:{intlName:"header.GIVE_PRO"},data:a,loc:{start:{line:32,column:80},end:{line:32,column:122}}}))+"</div>\n\t</div>\n"},compiler:[8,">= 4.3.0"],main:function(n,e,t,l,a){var o,i=null!=e?e:n.nullContext||{},s=n.hooks.helperMissing,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return(null!=(o=(r(t,"ifCond")||e&&r(e,"ifCond")||s).call(i,null!=e?r(e,"placement"):e,"===","photostream",{name:"ifCond",hash:{},fn:n.program(1,a,0),inverse:n.noop,data:a,loc:{start:{line:1,column:0},end:{line:8,column:11}}}))?o:"")+(null!=(o=(r(t,"ifCond")||e&&r(e,"ifCond")||s).call(i,null!=e?r(e,"placement"):e,"===","photoPageDownloadInterstitial",{name:"ifCond",hash:{},fn:n.program(3,a,0),inverse:n.noop,data:a,loc:{start:{line:9,column:0},end:{line:16,column:11}}}))?o:"")+(null!=(o=(r(t,"ifCond")||e&&r(e,"ifCond")||s).call(i,null!=e?r(e,"placement"):e,"===","sub-photo-left",{name:"ifCond",hash:{},fn:n.program(5,a,0),inverse:n.noop,data:a,loc:{start:{line:17,column:0},end:{line:22,column:11}}}))?o:"")+(null!=(o=(r(t,"ifCond")||e&&r(e,"ifCond")||s).call(i,null!=e?r(e,"placement"):e,"===","mobile-sub-photo",{name:"ifCond",hash:{},fn:n.program(7,a,0),inverse:n.noop,data:a,loc:{start:{line:23,column:0},end:{line:28,column:11}}}))?o:"")+(null!=(o=(r(t,"ifCond")||e&&r(e,"ifCond")||s).call(i,null!=e?r(e,"placement"):e,"===","context-menu",{name:"ifCond",hash:{},fn:n.program(9,a,0),inverse:n.noop,data:a,loc:{start:{line:29,column:0},end:{line:34,column:11}}}))?o:"")+"\n"},useData:!0}),l={};n.Array.each([],(function(e){var t=n.Template.get("hermes/"+e);t&&(l[e]=t)})),n.Template.register("hermes/gift-pro",(function(e,a){return(a=a||{}).partials=a.partials?n.merge(l,a.partials):l,t(e,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("gift-pro-view",(function(e,i){require("hermes-core/flog")(i);var t=new e.SubscriptionsHelper;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.params=e,this.recipientNsid=e.nsid||e.recipientNsid,this.placement=e.placement||"photostream",this.isViewingSelf=!1,this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===e.nsid&&(this.isViewingSelf=!0),this},loadState:function(){var i=[];return i.push(this.appContext.getModel("person-models",this.recipientNsid).then(function(e){this.set("recipientModel",e)}.bind(this))),this.appContext.getViewer().signedIn&&i.push(this.appContext.getModel("person-relationship-models",this.recipientNsid).then(function(e){this.set("relationshipModel",e)}.bind(this))),e.Promise.all(i)},buildContainer:function(){this.canViewerGiftPro()&&this.setContainerWithTemplate("gift-pro",{placement:this.placement})},activate:function(){var e=this.get("container").one(".open-gift-modal");let i=this,t=this.appContext.getViewer();this.appContext.flipper.isFlipped("enable-gift-pro")&&this.canViewerGiftPro()&&e&&this.registerEventHandler(e.on("click",(function(e){t.signedIn?i.openModal(e):i.showSignUpModal(e)})))},showSignUpModal:function(i){let t,n,s=this.get("recipientModel"),o=s?e.URLHelper.generatePersonUrls(s):"/",l=o.photostream?e.url(`${o.photostream}?giftPro`,{protocol:!1}):o,a=s?s.getValue("nsid"):"";i&&(i.stopPropagation(),i.preventDefault()),s&&(t=s.getValue("displayname")),n=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-gift-pro",signUpMessage:this.intlMessage({intlName:"gift-pro.GIFT_PRO_JOIN_FLICKR",userName:t}),beaconPrefix:"gift-pro"}),n.show(),n.on("signUpClick",(function(){e.SigninHelper.signUpToGiftPro({nsid:a},{postLoginUrl:l})})),n.on("signInClick",(function(){e.SigninHelper.loginToGiftPro({nsid:a},{postLoginUrl:l})}))},canViewerGiftPro:function(){var e=!1;return this.appContext.flipper.isFlipped("enable-gift-pro")?(!this.isViewingSelf&&this.get("recipientModel")&&(e=this.appContext.getViewer().signedIn?!(!this.get("relationshipModel")||!this.get("recipientModel").getValue("isEligibleForGifts")):!t.doesCountryRequiresSignedInGifting(this.geo)&&this.get("recipientModel").getValue("isEligibleForGifts")),e):e},openModal:function(i){var n;i&&(i.stopPropagation(),i.preventDefault()),this.get("recipientModel")&&(n=this.get("recipientModel").getValue("displayname")),this.checkoutModal=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!1,showBodyLines:!1,showCancelButton:!1,showFooter:!1,showCancelX:!0,title:this.intlMessage({intlName:"gift-pro.GIFT_FLICKR_PRO",name:n}),subview:new e.Views["gift-pro-checkout-view"]({appContext:this.appContext,isMobile:this.isMobile,shouldDisplayYearlyLegalNotice:!0,recipientNsid:this.recipientNsid}),classList:"gift-pro-modal"}),this.checkoutModal.show(),this.checkoutModal.on("close",function(){t.sendGiftPurchaseEvent({step:"gift_modal_closed",recipientNsid:this.recipientNsid,gifterNsid:this.appContext.getViewer().signedIn?this.appContext.getViewer().nsid:"anonymous"})}.bind(this)),this.registerEventHandler(e.on("giftPro:successfulPurchase",function(){this.checkoutModal.close(),this.displaySuccessfulGift()}.bind(this))),this.registerEventHandler(e.on("giftPro:reposition",function(){this.repositionModal()}.bind(this))),this.registerEventHandler(e.on("giftPro:somethingWentWrong",function(){this.checkoutModal.close(),this.somethingWentWrong()}.bind(this))),this.registerEventHandler(e.on("giftPro:cancelPayment",function(){this.checkoutModal.close()}.bind(this))),t.sendGiftPurchaseEvent({step:"gift_modal_open",recipientNsid:this.recipientNsid,gifterNsid:this.appContext.getViewer().signedIn?this.appContext.getViewer().nsid:"anonymous"})},displaySuccessfulGift:function(){var i=this.get("recipientModel")?this.get("recipientModel").getValue("displayname"):"";this.successfulGiftModal=new e.Views.FluidModal({actionButtonLabel:this.intlMessage({intlName:"gift-pro.OK_THANKS"}),htmlMessage:this.templates("gift-pro-success")({recipientName:i,avatar:this.buildAvatar().avatar,titleBlock:this.buildTitleBlock().titleBlock}),showBodyLines:!0,showHeader:!1,width:500,appContext:this.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!1,actionButtonDisabled:!1,actionButtonIsDangerous:!1,showCancelButton:!1,classList:"gift-pro-success-modal",showCancelX:!1}),this.successfulGiftModal.show(),this.registerEventHandler(this.successfulGiftModal.on("actionClick",function(){this.successfulGiftModal.close(),e.config.win.history.replaceState({},"",e.config.win.location.pathname),e.config.win.location.reload()}.bind(this)))},buildAvatar:function(){var i=this.get("recipientModel"),t=i&&i.getValue("buddyicon"),n=i&&e.URLHelper.generatePersonUrls(i);return i?{avatar:{canEdit:this.get("viewingSelf"),editUrl:"/iconbuilder/",sendFlickrMail:n.sendFlickrMail,linkUrl:n.photostream,icon:{retina:t.retina||t.large||t.medium,lowres:t.default},type:""}}:null},buildTitleBlock:function(){var e=this.get("recipientModel"),i={subtitle:"",follow:""};return e&&(i.title=e.getValue("displayname"),e.getValue("displayname")===e.getValue("realname")&&(i.subtitle=e.getValue("username")),i.isPro=!0,i.proBadge=e.getValue("proBadge")),{titleBlock:i}},repositionModal:function(e){this.checkoutModal&&this.checkoutModal.reposition()},somethingWentWrong:function(){var i=new e.Views.FluidModal({title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.REFRESH"}),textMessage:this.intlMessage({intlName:"gift-pro.SOMETHING_WENT_WRONG_GIFT"}),appContext:this.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!0,actionButtonDisabled:!1,actionButtonIsDangerous:!0,showCancelButton:!1,showCancelX:!0});i.on("actionClick",function(){e.config.win.location.reload()}.bind(this)),i.show()}})}),"@VERSION@",{requires:["flickr-view","fluid-modal-view","person-models","person-public-profile-models","person-relationship-models","subscriptions-helper","gift-pro-checkout-view","hermes-template-gift-pro-success","hermes-template-gift-pro","signup-modal-view","url","signin-helper","url-helper"],optionalRequires:["hermes-core"],langBundles:["header","common","wallet","gift-pro","checkout"]});