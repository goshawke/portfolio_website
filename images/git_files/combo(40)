YUI.add("fluid-share-view",(function(e,t){"use strict";var r=require("hermes-core/flog")(t),a=require("url-parse"),i="signedOutEmailSharing",s={shareRedirectURL:e.url("/window_close.html"),css:{shareBtn:"fluid-share-button",networkClasses:{twitter:{canShare:!1,className:"twitter-link",serviceId:9},facebook:{canShare:!1,className:"facebook-link",serviceId:128},tumblr:{canShare:!1,className:"tumblr-link",serviceId:12},pinterest:{canShare:!1,className:"pinterest-link",serviceId:132},flickr:{canShare:!1,className:"flickr-link",serviceId:130}}}},n={myflickryear21:"#MyFlickrYear21",myflickryear22:"#MyFlickrYear22",myflickryear23:"#MyFlickrYear23",default:"#flickr"};s.networks={facebook:{clientId:e.config.flickr.facebook.client_id,shareUrl:"https://www.facebook.com/dialog/share?app_id="+e.config.flickr.facebook.client_id+"&display=popup&redirect_uri="+encodeURIComponent(s.shareRedirectURL)+"&href="},twitter:{shareUrl:"https://twitter.com/intent/tweet?text={{tweetText}}&url={{linkToShare}}",hashTags:n.default},tumblr:{shareUrl:"https://www.tumblr.com/widgets/share/tool?caption={{tumblrCaption}}&tags={{tags}}&url={{linkToShare}}"},pinterest:{shareUrl:"https://pinterest.com/pin/create/bookmarklet/?media={{displayPhotoURL}}&url={{linkToShare}}&description={{description}}"},flickr:{apiCall:"flickr.sharing.post"}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.extraModalClasses=this.extraModalClasses||"","en-us"===this.appContext.lang.toLowerCase()?this.isEnglishLang=!0:this.isEnglishLang=!1,this.errorTitle=this.intlMessage({intlName:"common.OOPS"}),this.errorMessage=this.intlMessage({intlName:"share-modal.NO_SHAREABLE_ITEMS"}),this.removeOverlayOnClose=e.removeOverlayOnClose,this.showShareOnLoad=e.showShareOnLoad,this},loadState:function(){return e.Promise.resolve()},buildContainer:function(e){return e=e||{},this.setContainerWithTemplate("fluid-share",e),this},activate:function(){var t,r,i=this.get("container"),o="."+s.css.shareBtn,l=i.one(o);if(t=new a(window.location),(r=/share=([\w-]+)/.exec(t.query))&&r[1]&&(r=r[1])in n&&(s.networks.twitter.hashTags=n[r]),l&&(this.isEnglish||!this.isDisabled)&&(this.registerEventHandler(i.delegate(["click","keydown"],(function(t){"click"!==t.type&&13!==t.keyCode||(t.preventDefault(),e.rapidTracker.beacon(this.subClassName,"shareButtonClick"),this.getItemCount().then(function(t){e.rapidTracker.beacon(this.subClassName,"shareButtonClickCount",{count:t})}.bind(this)),this.prepareModal(l),this.beaconClick())}),o,this)),this.showShareOnLoad)){this.prepareModal(l);var c=e.config.win.location.href.split("?");if(c.length>1){var h=c[0],u="",p=c[1].split("&"),d=0;p.forEach((function(e){"share"!==e&&(u+=0==d++?"?"+e:"&"+e)})),e.config.win.history.replaceState({},"",h+u)}}return this},prepareModal:function(t){if(!this.shouldCancelModal())return this.getItemCount().then(function(r){return this.isDisabled?e.Promise.resolve(this.showErrorModal()):e.Promise.resolve(this.showModal(t,r,this.removeOverlayOnClose))}.bind(this)).catch((function(e){r.error({err:e})}))},showModal:function(t,a,n){var o,l,c,h=this,u=this.getIsMine(),p=s.css.networkClasses,d=h.getTitleIntlKey(),g={intlName:"share-modal."+d},m=this.getGuestPassParams(),f=this.prepareLinkShareParameters(),w=f.shortURL||e.url(f.url);return"SHARE_PHOTOS_TO"!==d&&"SHARE_VIDEO_TO"!==d||(g.count=a),navigator.share&&this.appContext.getUA().isMobileBrowser?(this.get("privacyModel")&&this.get("privacyModel").getValue("isPublic")?navigator.share({url:e.URLHelper.getShortURL(this.photoId)}):m.canSharePrivate||m.contentMarkedFriends||m.contentMarkedFamily||m.contentMarkedFriendFamily?((l=new e.Views.FluidModal({appContext:this.appContext,showCancelX:!1,showFooter:!0,actionButtonLabel:this.intlMessage({intlName:"share-modal.SHARE"}),title:this.intlMessage({intlName:"share-modal.SHARE_PHOTOS"}),subview:new e.Views["native-share-panel-view"]({appContext:h.appContext,linkShareParams:f,guestPassParams:m})}).show()).on("request-guestpass",(function(e,t,r){(r.is_private||r.is_family||r.is_friend)&&(l.disableActionButton(),this.appContext.callAPI("flickr.sharing.createGuestpass",r).then((function(e){w=e.guestpass.url,l.enableActionButton()})).catch((function(e){l.close()})))})),l.on("actionClick",(function(e){navigator.share({url:w}).then((function(){return this})).catch((function(e){r.error({err:e})}))}))):this.get("photos").length>0||!this.getIsMine()?navigator.share({url:w}).then((function(){return this})).catch((function(e){r.error({err:e})})):(c="photostream"===m.type?"share-modal.PHOTOSTREAM_PRIVATE":"share-modal.NO_SHAREABLE_ITEMS",new e.Views.FluidModal({appContext:this.appContext,subview:new e.Views["confirmation-dialog-view"]({appContext:this.appContext,title:this.intlMessage({intlName:"common.OOPS"}),htmlMessage:this.intlMessage({intlName:c}),showCancelButton:!1}),hasSubviewConfigRefactor:!0}).show()),this):((o=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,noScroll:!0,maxHeight:!1,showFooter:!1,title:h.intlMessage(g),classList:"modal-restyle "+h.extraModalClasses,width:560,subview:new e.Views["fluid-share-panel-view"]({appContext:h.appContext,networkClasses:p,linkShareParams:this.prepareLinkShareParameters(),guestPassParams:this.getGuestPassParams(),emailShareParams:this.prepareFlickrShareParameters(),isMine:u,shareItemCount:a,signedOutSharingPerms:this.getSignedOutSharingPerms(),canVr:this.get("canVr")}),removeOverlayOnClose:n})).registerEventHandler(o.get("container").delegate(["click","keydown"],(function(e){"click"!==e.type&&13!==e.keyCode||(e.preventDefault(),e.target.ancestor("."+p.facebook.className,!0)?h.preProcessShare(h.prepareFacebookShareParameters,h.shareToFacebook):e.target.ancestor("."+p.twitter.className,!0)?h.preProcessShare(h.prepareTwitterShareParameters,h.shareToTwitter):e.target.ancestor("."+p.tumblr.className,!0)?h.preProcessShare(h.prepareTumblrShareParameters,h.shareToTumblr):e.target.ancestor("."+p.pinterest.className,!0)&&h.preProcessShare(h.preparePinterestShareParameters,h.shareToPinterest))}),".share-link.sharing-type-enabled")),o.on("share-by-email",(function(t){var r=e.merge(h.prepareFlickrShareParameters(),t);h.shareToFlickr(o,r)})),o.on("done-sharing",(function(t){o.close(),h.guestPassURLs={},e.rapidTracker.beacon(this.subClassName,"doneSharingClick")})),o.on("request-guestpass",(function(e,t,r){h.requestGuestpass(o,t,r,!0)})),o.on("generate-link",(function(){h.generateLink().then((function(e){o.fire("parentViewEvent","generated-link",e)}))})),o.on("activated",(function(){o.get("subview").cancel&&o.get("container").one(".title").setHTML(h.intlMessage({intlName:"common.OOPS"})),o.reposition()})),o.on("guestpass-required",(function(){h.guestpassRequired=!0})),o.on("confirm-sign-in",(function(){o.close();let t=new e.Views.FluidModal({appContext:this.appContext,subview:new e.Views["confirmation-dialog-view"]({appContext:this.appContext,title:this.intlMessage({intlName:"common.OOPS"}),htmlMessage:h.intlMessage({intlName:"share-modal.SIGN_IN_TO_EMAIL"}),showCancelButton:!0,onConfirm:async(t,r)=>{e.StorageHelper.setItem(i,new Date),e.SigninHelper.addPendingShare({shareType:"email"})}}),hasSubviewConfigRefactor:!0});setTimeout((function(){t.show()}),10)})),o.on("close",(function(){h.fire("sharePresentationClose"),h.guestPassURLs={},e.rapidTracker.beacon(h.name,"shareModalCancelClick")})),o.on("closeAll",(function(){h.fire("sharePresentationClose"),o.close(),h.guestPassURLs={}})),o.show(),this.sharePresentation=o,o)},showErrorModal:function(){return new e.Views.FluidModal({appContext:this.appContext,subview:new e.Views["confirmation-dialog-view"]({appContext:this.appContext,title:this.errorTitle,htmlMessage:this.errorMessage,showCancelButton:!1}),hasSubviewConfigRefactor:!0}).show()},prepareFacebookShareParameters:function(){return{url:"",count:1}},prepareTwitterShareParameters:function(){return{shortURL:"",url:"",title:"",count:1}},prepareTumblrShareParameters:function(){return{title:"",authorURL:"",ownerName:"",description:"",displayPhotoURL:"",url:"",count:1}},preparePinterestShareParameters:function(){return{title:"",description:"",displayPhotoURL:"",shortURL:"",url:"",count:1}},prepareFlickrShareParameters:function(){return{modelName:"",modelId:"",title:"",url:"",count:1}},prepareLinkShareParameters:function(){return{sizes:{},url:"",title:"",author:"",authorURL:"",shortURL:"",supportsEmbedr:!1,supportsBBCode:!1,privacyWarningString:"",generateLink:!1}},getTitleIntlKey:function(){return"SHARE_PHOTOS_TO"},getItemCount:function(){return e.Promise.resolve(1)},getIsMine:function(){return!1},getGuestPassParams:function(){return{type:null,id:null,contentMarkedFriends:!0,contentMarkedFamily:!0,contentMarkedFriendFamily:!0,contentMarkedPublic:!0,canSharePrivate:!1,sharingEntirelyNotPublic:!1,multipleItems:!1,nonPublicWarning:null,shareToAll:!1,showGuestPassDropdown:!1,shareToSpecific:null}},getSignedOutSharingPerms:function(){return{facebook:{canShare:!0},twitter:{canShare:!0},tumblr:{canShare:!0},pinterest:{canShare:!0},flickr:{canShare:!1}}},shouldCancelModal:function(){return!1},shareToFacebook:function(t,a){if(!t.url)return r.error("Error sharing to Facebook.  Missing url.");var i,n,o,l,c,h=encodeURIComponent(e.url(t.url)),u=this.guestPassURLs;this.guestpassRequired&&u&&(n=u[100],(o=u["010"])&&(h=o),n&&(h=n),(l=u[110])&&(h=l),(c=u[111])&&(h=c)),i=s.networks.facebook.shareUrl+h,e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"facebook",count:t.count||1}),a?a.location.replace(i):a=this.createSharePopup(i),this.trackShareCompletion(a)},shareToTwitter:function(t,a){if(void 0===t.url||null===t.url)return r.error("Error sharing to Twitter.  Missing url.");if(!t.title)return r.error("Error sharing to Twitter.  Missing title.");var i,n,o,l,c=t.title;n=""===t.url?"":encodeURIComponent(t.url),(l=c+" "+s.networks.twitter.hashTags).length+n.length>140&&(o=l.length+n.length-140,l=c.substring(0,c.length-(o+1))+"… "+s.networks.twitter.hashTags),i=s.networks.twitter.shareUrl.replace("{{tweetText}}",encodeURIComponent(l)).replace("{{linkToShare}}",n),a?a.location.replace(i):a=this.createSharePopup(i),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"twitter",count:t.count||1}),this.trackShareCompletion(a)},shareToTumblr:function(t,a){if(!t.title)return r.error("Error sharing to Tumblr.  Missing title.");if(!t.displayPhotoURL)return r.error("Error sharing to Tumblr.  Missing displayPhotoURL.");var i,n,o,l,c,h=t.title,u=t.tags||"",p=t.description,d=e.URLHelper.addProtocolToURL(t.displayPhotoURL),g=t.isPhotoPage,m=s.networks.tumblr.shareUrl;g&&this.appContext.flipper.isFlipped("enable-tumblr-embed-share")||(m+="&shareSource=legacy&posttype=photo&content={{displayPhotoURL}}&clickthroughUrl={{linkToShare}}"),t.authorURL&&(n=e.url(t.authorURL)),t.ownerName&&(o=t.ownerName),l=0===t.url.indexOf("https://")?t.url:0===t.url.indexOf("//")?e.URLHelper.addProtocolToURL(t.url):e.url(t.url),i=this.templates("fluid-share-tumblr-post")({title:h,ownerURL:n,ownerName:o,description:p,linkToShare:l}),c=m.replace("{{displayPhotoURL}}",encodeURIComponent(d)).replace("{{tumblrCaption}}",encodeURIComponent(i)).replace(/{{linkToShare}}/g,encodeURIComponent(l)).replace("{{tags}}",encodeURIComponent(u)),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"tumblr",count:t.count||1}),a?a.location.replace(c):a=this.createSharePopup(c,!0)},shareToPinterest:function(t,a){if(!t.title)return r.error("Error sharing to Pinterest.  Missing title.");if(!t.displayPhotoURL)return r.error("Error sharing to Pinterest.  Missing displayPhotoURL.");if(!t.url)return r.error("Error sharing to Pinterest.  Missing url.");if(!t.shortURL)return r.error("Error sharing to Pinterest.  Missing shortURL.");var i,n,o,l=e.Handlebars.helpers.stripTags(t.description)||"",c=t.shortURL,h=t.title,u=e.URLHelper.addProtocolToURL(t.displayPhotoURL);n=encodeURIComponent(e.url(t.url)),o=""!==l.trim()?c+" | "+h+" | "+l:c+" | "+h,u=u.replace("https:","http:"),n=n.replace("https:","http:"),i=s.networks.pinterest.shareUrl.replace("{{displayPhotoURL}}",encodeURIComponent(u)).replace("{{description}}",encodeURIComponent(o)).replace("{{linkToShare}}",n),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"pinterest",count:t.count||1}),a?a.location.replace(i):a=this.createSharePopup(i,!0)},shareToFlickr:function(t,a){if(!a.recipients)return r.error("Error sharing to Flickr.  Missing recipients.");if(!a.url)return r.error("Error sharing to Flickr.  Missing url.");if(!a.modelName)return r.error("Error sharing to Flickr.  Missing modelName.");if(!a.modelId)return r.error("Error sharing to Flickr.  Missing modelId.");var n,o,l=a.modelName,c=a.modelId,h=a.recipients,u=a.message||"",p=a.guestpassStr||"public",d=a.enablePrint||!1,g={},m=[],f=[];for(n in encodeURIComponent(e.url(a.url)),"share_code"===l?g[l]=c:g[l+"_id"]=c,g.service_type_id="130",g.owner_id=this.appContext.getViewer().nsid,"public"!==p&&("friends"!==p&&"family_and_friends"!==p||(g.guestpass_friends="1"),"family"!==p&&"family_and_friends"!==p||(g.guestpass_family="1"),"private"===p&&(g.guestpass_private="1",g.guestpass_friends="1",g.guestpass_family="1")),d&&(g.guestpass_print=1),h)(o=h[n]||{}).email?m.push(o.email):o.nsid&&f.push(o.nsid);g.to_flickr=f.join(","),g.to_email=m.join(","),g.message=e.flutil.escapeInput(u),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"flickr",count:a.count||1,flkcnt:f.length,emailcnt:m.length});var w,k=e.StorageHelper.getItem(i);if(k)try{(w=e.moment(k)).isValid()&&(new e.moment).diff(w,"hours")<2&&(e.rapidTracker.beacon(this.get("parentViewName"),"signedOutEmailShare",{count:a.count||1}),e.StorageHelper.remove(i))}catch(e){}if(!s.networks)throw new Error("Missing sharing api configuration.");this.appContext.callAPI(s.networks.flickr.apiCall,g).then((function(){t&&t.fire("parentViewEvent","flickr-share-success")}),(function(e){t&&t.fire("parentViewEvent","flickr-share-error")}))},generateLink:function(){var t=this;return this.onBeforeShare().then((function(e){return e}),(function(r){t.sharePresentation.fire("closeAll"),setTimeout((function(){new e.Views.FluidModal({appContext:t.appContext,subview:new e.Views["confirmation-dialog-view"]({appContext:t.appContext,title:t.intlMessage({intlName:"common.OOPS"}),htmlMessage:t.intlMessage({intlName:"share-modal.CANCEL_SHARE_BECAUSE_ERROR",photoCount:t.getGuestPassParams.multipleItems?10:1}),showCancelButton:!1}),hasSubviewConfigRefactor:!0}).show()}),10)}))},preProcessShare:function(e,t){var a=this;if(this.onBeforeShare){var i=this.createSharePopup("",!0);try{i.document.body.innerHTML=a.templates("fluid-share-loading-state")()}catch(e){18===e.code&&(i.close(),(i=this.createSharePopup("",!0)).document.body.innerHTML=a.templates("fluid-share-loading-state")())}this.onBeforeShare().then((function(s){var n;try{n=e.call(a)}catch(e){r.error("Error getting share parameters",{err:e})}t.call(a,n,i)}))}else{var s;try{s=e.call(a)}catch(e){r.error("Error getting share parameters",{err:e})}t.call(a,s)}},trackShareCompletion:function(t){var a=function(i){if(i.source===t)if(i.origin===e.url("/")&&"Window closed"===i.data)r.log("Closing Facebook window."),e.rapidTracker.beacon(this.get("parentViewName"),"photoSharedToFacebook"),e.config.win.removeEventListener("message",a,!1);else if(i.origin===e.url("/")&&0===i.data.indexOf("share failure"))r.error("Got Facebook error",{data:i.data}),e.config.win.removeEventListener("message",a,!1);else if("https://twitter.com"===i.origin&&"__ready__"!==i.data)try{r.log("Tracking share completion",{data:i.data}),"tweet"===JSON.parse(i.data).params[0]&&i.returnValue&&(e.rapidTracker.beacon(this.get("parentViewName"),"photoSharedToTwitter"),e.config.win.removeEventListener("message",a,!1))}catch(e){r.error("Error tracking share completion",{err:e})}};e.config.win.addEventListener("message",a,!1)},createSharePopup:function(t,r){var a={},i="",s="nativeShare"+(new Date).getTime();return a.width=r?950:640,a.height=480,a.top=(e.config.win.screen.height-a.height)/2,a.left=(e.config.win.screen.width-a.width)/2,e.Object.each(a,(function(e,t){i+=t+"="+e+","})),i=i.slice(0,-1),e.config.win.open(t,s,i)},requestGuestpass:function(e,t,r,a){var i=this;this.guestPassURLs||(this.guestPassURLs={}),this.guestPassURLs[t]?e.fire("parentViewEvent","guestpass-created",t,this.guestPassURLs[t]):this.appContext.callAPI("flickr.sharing.createGuestpass",r).then((function(r){if(!r||!r.guestpass||!r.guestpass.url)throw new Error("No guestpass returned");i.guestPassURLs[t]=r.guestpass.url,e.fire("parentViewEvent","guestpass-created",t,i.guestPassURLs[t])}),(function(s){a?i.requestGuestpass(e,t,r):e.fire("parentViewEvent","guestpass-failed",s)}))},beaconClick:function(){}},{ATTRS:{parentViewName:{value:""}}})}),"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-modal-view","hermes-template-fluid-share","hermes-template-fluid-share-tumblr-post","hermes-template-fluid-share-loading-state","fluid-share-panel-view","native-share-panel-view","url","flutil","url-helper","signin-helper","handlebars-helpers","moment"],optionalRequires:["fluid","hermes-core"],langBundles:["share-modal","common"]});YUI.add("fluid-share-photo-view",(function(e,t){e.FlickrView.create(this.name,e.namespace("Views")["fluid-share-view"],[],{langBundles:this.details.langBundles,subClassName:t,initializer:function(e){var t=e.subviewParams?e.subviewParams["fluid-share-photo-view"]:{};return e=Object.assign(e,t),this.nsid=e.nsid,this.photoId=e.photoId,this.size=e.size,this.theme=e.theme,this.constructor.superclass.initializer.call(this,e)},loadState:function(){var t=this;return e.Promise.all([this.appContext.getModel("photo-models",this.photoId),this.appContext.getModel("photo-privacy-models",this.photoId),this.appContext.getModel("photo-engagement-models",this.photoId)]).then((function(e){return t.set("photoModel",e[0]),t.set("privacyModel",e[1]),t.set("engagementModel",e[2]),t.get("photoModel").canVr().then((function(e){t.set("canVr",e)}))}))},buildContainer:function(){var e=2===this.get("photoModel").getValue("safetyLevel");return this.get("photoModel").getValue("owner").id!==this.appContext.getViewer().nsid&&(e=e||!this.get("privacyModel").getValue("isPublic")),this.constructor.superclass.buildContainer.call(this,{extraShareButtonIconClassList:"share-photo-icon",showShareButtonLabel:!1,sharingDisabled:e,shareTooltip:this.intlMessage({intlName:"share-modal.SHARE_PHOTO"}),size:this.size,theme:this.theme}),this},prepareFacebookShareParameters:function(){return{url:this.get("photoModel").getValue("url")}},prepareTwitterShareParameters:function(){var t=this.get("photoModel");return{url:e.URLHelper.getShortURL(t.getValue("id")),title:t.getValue("title")||this.intlMessage({intlName:"common.UNTITLED"})}},prepareTumblrShareParameters:function(){var e=this.get("photoModel"),t=e.getValue("owner"),i=e.getLargestSize({excludeSizes:["o"]}).displayUrl,a=this.appContext.flipper.isFlipped("enable-flickr-embeds-on-tumblr"),o=this.get("tags");return{title:e.getValue("title")||this.intlMessage({intlName:"common.UNTITLED"}),authorURL:t.getValue("url"),ownerName:t.getValue("displayname"),description:e.getValue("description"),displayPhotoURL:a?e.getValue("url"):i,url:e.getValue("url"),isPhotoPage:!0,tags:o?o.map((function(e){return e.tagRaw})).join(","):""}},preparePinterestShareParameters:function(){var t=this.get("photoModel");return{title:t.getValue("title")||this.intlMessage({intlName:"common.UNTITLED"}),description:t.getValue("description"),displayPhotoURL:t.getLargestSize({excludeSizes:["o"]}).displayUrl,shortURL:e.URLHelper.getShortURL(t.getValue("id")),url:t.getValue("url"),count:1}},prepareFlickrShareParameters:function(){var e=this.get("photoModel");return{title:e.getValue("title")||this.intlMessage({intlName:"common.UNTITLED"}),modelName:"photo",modelId:e.getValue("id"),url:e.getValue("url"),count:1}},prepareLinkShareParameters:function(){var t,i=this.get("photoModel"),a=this.get("privacyModel"),o=this.get("engagementModel").getValue("canShare");return t=!(!o||!this.get("photoModel").getValue("isVideo"))||o&&!this.get("photoModel").getValue("isVideo"),{url:e.config.win.location.pathname,author:i.getValue("owner").getValue("displayname"),authorURL:i.getValue("owner").getValue("url"),shortURL:e.URLHelper.getShortURL(i.getValue("id")),supportsEmbedr:t,supportsBBCode:o,sizes:i.getValue("sizes"),title:i.getValue("title")||this.intlMessage({intlName:"common.UNTITLED"}),secret:i.getValue("secret"),privacyWarningString:this.intlMessage({intlName:"share-modal.PHOTO_PAGE_PRIVACY_WARNING"}),aspectRatio:i.getValue("aspectRatio"),isNonPublic:!a.getValue("isPublic")}},getTitleIntlKey:function(){return this.get("photoModel").getValue("isVideo")?"SHARE_VIDEO_TO":"SHARE_PHOTOS_TO"},getGuestPassParams:function(){var e,t=this.get("privacyModel"),i=t.getValue("isVisibleByFriends"),a=t.getValue("isVisibleByFamily"),o=!t.getValue("isPublic"),s=this.get("photoModel"),l=s.getValue("isVideo"),r=6===t.getValue("permPrint"),n=s.getValue("isOwner");return a&&i?e=this.intlMessage({intlName:"share-modal.PHOTO_FAMILY_FRIENDS_MESSAGE"}):a?e=this.intlMessage({intlName:"share-modal.PHOTO_FAMILY_MESSAGE"}):i?e=this.intlMessage({intlName:"share-modal.PHOTO_FRIENDS_MESSAGE"}):o&&(e=this.intlMessage({intlName:"share-modal.PHOTO_PRIVATE_MESSAGE"})),{type:"photo",id:this.photoId,contentMarkedFriends:n&&i&&!a,contentMarkedFamily:n&&a&&!i,contentMarkedFriendFamily:n&&a&&i,contentMarkedPublic:!o&&!a&&!i,canSharePrivate:n&&o&&!a&&!i,showGuestPassDropdown:n&&o,multipleItems:!1,sharingEntirelyNotPublic:n&&o,showOptionToEnablePrint:n&&!l&&!r,nonPublicWarning:e}},getIsMine:function(){return this.get("photoModel").getValue("isOwner")},getSignedOutSharingPerms:function(){var e=this.get("engagementModel").getValue("canShare");return{facebook:{canShare:e},twitter:{canShare:e},tumblr:{canShare:e},pinterest:{canShare:e},flickr:{canShare:!1}}},onParentViewEvent:function(e,t){"enable-sharing"!==t[0]&&"disable-sharing"!==t[0]||this.buildContainer()},shouldCancelModal:function(){var e=2===this.get("photoModel").getValue("safetyLevel");return e&&this.buildContainer(),e},onBeforeShare:function(){if(this.photoId)return this.appContext.getModel("photo-tags-models",this.photoId).then((e=>{this.set("photoTagsModels",e),this.set("tags",this.get("photoTagsModels").getValue("tags").toJSON())}))},destructor:function(){this.fire("destroy")},beaconClick:function(){var t=this.get("photoModel");t&&e.Snowplough&&e.Snowplough.sendStructuredEvent({category:"engagement",action:"photoShareClick"},e.Snowplough.getPhotoContextFromModel(t))}})}),"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-share-view","url-helper","flutil"],langBundles:["models","share-modal"]});YUI.add("hermes-template-print-button",(function(n,e){var t=n.Template.Handlebars.revive({1:function(n,e,t,l,r){var o,a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return" "+n.escapeExpression("function"==typeof(o=null!=(o=a(t,"iconSize")||(null!=e?a(e,"iconSize"):e))?o:n.hooks.helperMissing)?o.call(null!=e?e:n.nullContext||{},{name:"iconSize",hash:{},data:r,loc:{start:{line:3,column:52},end:{line:3,column:64}}}):o)},compiler:[8,">= 4.3.0"],main:function(n,e,t,l,r){var o,a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'<div class="print-button-container">\n\t<a role="button" class="print-button">\n\t\t<svg class="icon icon-cart_hollow'+(null!=(o=a(t,"if").call(null!=e?e:n.nullContext||{},null!=e?a(e,"iconSize"):e,{name:"if",hash:{},fn:n.program(1,r,0),inverse:n.noop,data:r,loc:{start:{line:3,column:35},end:{line:3,column:71}}}))?o:"")+'"><use xlink:href="#icon-cart_hollow"></use></svg>\n\t</a>\n</div>'},useData:!0}),l={};n.Array.each([],(function(e){var t=n.Template.get("hermes/"+e);t&&(l[e]=t)})),n.Template.register("hermes/print-button",(function(e,r){return(r=r||{}).partials=r.partials?n.merge(l,r.partials):l,t(e,r)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-print-icon-tooltip",(function(e,n){var t=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,n,t,a,l){var s=null!=n?n:e.nullContext||{},i=e.hooks.helperMissing,r=e.escapeExpression,o=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'<div class="print-icon-tooltip-container">\n\t<header>\n\t\t<h3>'+r((o(t,"intlMessage")||n&&o(n,"intlMessage")||i).call(s,{name:"intlMessage",hash:{intlName:"common.NEW"},data:l,loc:{start:{line:3,column:6},end:{line:3,column:43}}}))+'</h3>\n\t\t<svg class="close-x-button"><use xlink:href="#icon-close"></use></svg>\n\t</header>\n\t<div class="print-icon-description">\n\t\t<span>'+r((o(t,"intlMessage")||n&&o(n,"intlMessage")||i).call(s,{name:"intlMessage",hash:{intlName:"prints.PRINT_TOOLTIP_TEXT_1"},data:l,loc:{start:{line:7,column:8},end:{line:7,column:62}}}))+'</span>\n\t\t<a href="/prints">'+r((o(t,"intlMessage")||n&&o(n,"intlMessage")||i).call(s,{name:"intlMessage",hash:{intlName:"common.LEARN_MORE"},data:l,loc:{start:{line:8,column:20},end:{line:8,column:64}}}))+'</a>\n\t</div>\n\t<div class="print-icon-fine-print">'+r((o(t,"intlMessage")||n&&o(n,"intlMessage")||i).call(s,{name:"intlMessage",hash:{intlName:"prints.PRINT_TOOLTIP_TEXT_2"},data:l,loc:{start:{line:10,column:36},end:{line:10,column:90}}}))+"</div>\n</div>\n"},useData:!0}),a={};e.Array.each([],(function(n){var t=e.Template.get("hermes/"+n);t&&(a[n]=t)})),e.Template.register("hermes/print-icon-tooltip",(function(n,l){return(l=l||{}).partials=l.partials?e.merge(a,l.partials):a,t(n,l)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-prepare-print-modal",(function(e,t){var a=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,t,a,n,l){var s,i=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,o=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="prepare-print-modal-container loading">\n\t<div class="loading-container">\n\t\t<span class="preparing-text">'+o((c(a,"intlMessage")||t&&c(t,"intlMessage")||r).call(i,{name:"intlMessage",hash:{intlName:"prints.PREPARING_YOUR_PHOTO"},data:l,loc:{start:{line:3,column:31},end:{line:3,column:85}}}))+'</span>\n\t\t<span class="flickr-balls-container">\n'+(null!=(s=e.invokePartial(c(n,"flickr-balls"),t,{name:"flickr-balls",data:l,indent:"\t\t\t",helpers:a,partials:n,decorators:e.decorators}))?s:"")+'\t\t</span>\n\t</div>\n\t<div class="error-container">\n\t\t<h1>'+o((c(a,"intlMessage")||t&&c(t,"intlMessage")||r).call(i,{name:"intlMessage",hash:{intlName:"common.OOPS"},data:l,loc:{start:{line:9,column:6},end:{line:9,column:44}}}))+'</h1>\n\t\t<p class="error-message"></p>\n\t\t<div class="button-container">\n\t\t\t<button class="mini alt cancel-button">'+o((c(a,"intlMessage")||t&&c(t,"intlMessage")||r).call(i,{name:"intlMessage",hash:{intlName:"common.CANCEL"},data:l,loc:{start:{line:12,column:42},end:{line:12,column:82}}}))+'</button>\n\t\t\t<button class="mini action retry-button">'+o((c(a,"intlMessage")||t&&c(t,"intlMessage")||r).call(i,{name:"intlMessage",hash:{intlName:"common.RETRY"},data:l,loc:{start:{line:13,column:44},end:{line:13,column:83}}}))+"</button>\n\t\t</div>\n\t</div>\n</div>"},usePartial:!0,useData:!0}),n={};e.Array.each(["flickr-balls"],(function(t){var a=e.Template.get("hermes/"+t);a&&(n[t]=a)})),e.Template.register("hermes/prepare-print-modal",(function(t,l){return(l=l||{}).partials=l.partials?e.merge(n,l.partials):n,a(t,l)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-flickr-balls"]});YUI.add("prepare-print-modal-view",(function(e,r){require("hermes-core/flog")(r);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){},buildContainer:function(){this.setContainerWithTemplate("prepare-print-modal")},activate:function(){var e=this,r=this.get("container");this.contentContainer=r.one(".prepare-print-modal-container"),this.loadingContainer=r.one(".loading-container"),this.errorContainer=r.one(".error-container"),this.errorTextContainer=this.errorContainer.one(".error-message"),this.errorRetryButton=this.errorContainer.one("button.retry-button"),this.errorCancelButton=this.errorContainer.one("button.cancel-button"),this.registerEventHandler(this.errorRetryButton.on("click",(function(){e.fire("retryClicked")}))),this.registerEventHandler(this.errorCancelButton.on("click",(function(){e.fire("closeClicked")})))},showError:function(e){this.contentContainer.removeClass("loading"),this.contentContainer.addClass("error"),e&&this.errorTextContainer.set("text",e)},showLoading:function(){this.contentContainer.addClass("loading"),this.contentContainer.removeClass("error")}})}),"@VERSION@",{requires:["flickr-view","hermes-template-prepare-print-modal"],optionalRequires:["hermes-core"],langBundles:["common","prints"]});YUI.add("hermes-lang-prints",(function(e,t){e.Intl.add("hermes/prints","en-US",{PRINTS:[{type:0,value:"Prints"}],SIGNUP_MODAL_TITLE:[{type:0,value:"Get amazing prints!"}],SIGNUP_MODAL_MESSAGE:[{type:0,value:"Join Flickr to gain access to our amazing print labs for all of your photos."}],GET_STARTED:[{type:0,value:"Get started"}],PRINTS_AND_GIFTS:[{type:0,value:"Prints & Wall Art"}],VIEW_CART:[{type:0,value:"View Cart"}],VIEW_CART_WITH_COUNT:[{type:0,value:"View Cart ("},{type:1,value:"count"},{type:0,value:")"}],BUY_PRINTS:[{type:0,value:"Buy prints"}],PHOTO_BOOKS_MENU_TEXT:[{type:0,value:"Photo Books"}],CHOOSE_PHOTO_TO_GET_PRINTS:[{type:0,value:"Choose a photo to get prints and wall art."}],BUY_PRINTS_MENU_TEXT:[{type:0,value:"Buy Prints"}],CHOOSE_YOUR_PHOTO_TO_GET_PRINTS:[{type:0,value:"Choose one of your photos to get prints and wall art."}],LEARN_MORE_THEN_FEEDBACK:[{type:0,value:'<a class="learn-link" href="'},{type:1,value:"learnUrl"},{type:0,value:'" target="_blank">Learn more</a> then <a class="feedback-link" href="'},{type:1,value:"feedbackUrl"},{type:0,value:'" target="_blank">tell us what you think!</a>'}],GET_PRINTS:[{type:0,value:"Get prints"}],THANKS_FOR_YOUR_ORDER:[{type:0,value:"Thanks for your order!"}],YOUR_ORDER_NUMBER_IS:[{type:0,value:'Your order number is <a class="order-link" href="'},{type:1,value:"orderUrl"},{type:0,value:'" target="_blank">'},{type:1,value:"orderNum"},{type:0,value:"</a>."}],YOULL_RECEIVE_ORDER_EMAIL:[{type:0,value:'You’ll receive an email with your order details at <span class="email-span">'},{type:1,value:"email"},{type:0,value:"</span>."}],HAVE_QUESTIONS_LINE:[{type:0,value:'Have questions? Check out <a class="help-link" href="'},{type:1,value:"helpUrl"},{type:0,value:'" target="_blank">our Help Center</a>.'}],WE_WELCOME_FEEDBACK_HERE:[{type:0,value:'We welcome <a class="feedback-link" href="'},{type:1,value:"feedbackUrl"},{type:0,value:'" target="_blank">your feedback here</a>.'}],PRINT_TOOLTIP_TEXT:[{type:0,value:"You can now get prints and wall art of your own photos. (This is only available to you for your photos)"}],PRINT_TOOLTIP_TEXT_1:[{type:0,value:"You can now get prints and wall art of your own photos."}],PRINT_TOOLTIP_TEXT_2:[{type:0,value:"This service is only available to you for your photos."}],GET_PRINTS_WALL_ART_TITLE:[{type:0,value:"Get prints and wall art of your photos"}],GET_PRINTS_WALL_ART_DESCRIPTION:[{type:0,value:"Choose from metal, canvas, or paper prints in many sizes and styles."}],SELECT_FROM_YOUR_PHOTOS:[{type:0,value:"Select from your photos"}],ENGLISH_LANGUAGE_AHEAD:[{type:0,value:"English language ahead!"}],ORDERING_IS_ENGLISH_ONLY:[{type:0,value:"Our ordering process is English-only at the moment. Please proceed if you’re comfortable reading English."}],CONTINUE_IN_ENGLISH:[{type:0,value:"Continue in English"}],PRINTS_AND_WALL_ART:[{type:0,value:"Prints & Wall Art"}],GET_STUNNING_WALL_ART:[{type:0,value:"Get stunning wall art and high-quality prints of your photos"}],GET_STUNNING_ALL:[{type:0,value:"Stunning wall art and high-quality prints"}],CHOOSE_PHOTOS:[{type:0,value:"Choose photos"}],METAL_PRINTS:[{type:0,value:"Metal prints"}],METAL_PRINTS_DESCRIPTION:[{type:0,value:"Metal prints deliver unparalleled color and vibrance to produce a depth and clarity unlike any other photographic wall art. If you want a print as bold as your most epic photos, look no further than metal prints."}],PAPER_PRINTS:[{type:0,value:"Paper prints"}],PAPER_PRINTS_DESCRIPTION:[{type:0,value:"Paper prints are a time-honored way to show off and share your favorite photos. From stacks of 4x6s to frameable statement pieces, you’ll be able to find the perfect size and paper finish for any  photo."}],CANVAS_PRINTS:[{type:0,value:"Canvas prints"}],CANVAS_PRINTS_DESCRIPTION:[{type:0,value:"Add a little class to your home, office, or whatever other space needs  a classic canvas print. With shapes and sizes perfect for wherever you want to hang your photos, your images will look outstanding."}],WHO_CAN_PRINT_PHOTOS_QUESTION:[{type:0,value:"Who can print my photos?"}],WHO_CAN_PRINT_PHOTOS_ANSWER:[{type:0,value:"Only you can print your photos through Flickr. Visitors to your account will not see the option to buy prints of your photos."}],WHO_MAKES_PRINTS_QUESTION:[{type:0,value:"Who makes the prints and wall art?"}],WHO_MAKES_PRINTS_ANSWER:[{type:0,value:"Flickr Prints benefit from years of experience that SmugMug has in printing beautiful imagery. Depending on your location, your prints will come from Bay Photo, White House Custom Colour, or Loxley Colour. All the labs we use have excellent color reproduction and fantastic reputations."}],HOW_LONG_SHIP_QUESTION:[{type:0,value:"How long does shipping take?"}],HOW_LONG_SHIP_ANSWER:[{type:0,value:"We ship all over the world, including more than 160 countries. No matter where you are, we’ll get your prints to you as fast as we can. Expedited shipping is available to get your prints even faster."}],WHAT_IF_WRONG_ORDER_QUESTION:[{type:0,value:"What if something is wrong with my order?"}],WHAT_IF_WRONG_ORDER_ANSWER:[{type:0,value:'If you’re ever unhappy with your prints or wall art, Flickr will make it right. Simply send us an email within 30 days of receiving your order and we’ll help you out. If you have any issues, <a class="support-link" href="'},{type:1,value:"supportUrl"},{type:0,value:'" target="_blank">reach out to our Support Heroes</a>.'}],WHERE_PHOTO_BOOK_QUESTION:[{type:0,value:"Where can I make a photo book?"}],WHERE_PHOTO_BOOK_ANSWER:[{type:0,value:"We partner with Blurb and Chatbooks for both hard-cover and soft-cover photo books. Your Flickr photo stream and albums are seamlessly integrated into the book-making process. Check out photo books."}],WHERE_PHOTO_BOOK_ANSWER_WITH_LINKS:[{type:0,value:'We partner with <a class="blurb-link" href="'},{type:1,value:"blurbUrl"},{type:0,value:'" target="_blank">Blurb</a> for both hard-cover and soft-cover photo books. Your Flickr photo stream and albums are seamlessly integrated into the book-making process. <a class="photo-books-link" href="'},{type:1,value:"photoBooksUrl"},{type:0,value:'" target="_blank">Check out photo books.</a>'}],MORE_QUESTIONS_QUESTION:[{type:0,value:"More questions?"}],MORE_QUESTIONS_ANSWER:[{type:0,value:'Please visit the <a class="help-link" href="'},{type:1,value:"helpUrl"},{type:0,value:'" target="_blank">Flickr Help Center</a> for more information or to connect with a Support Hero.'}],PREPARING_YOUR_PHOTO:[{type:0,value:"Preparing your photo..."}],SOMETHING_WRONG_PREPARING_PRINT:[{type:0,value:"Something went wrong while preparing your photo for prints."}],MID_PAGE_PHOTO_ATTRIBUTION:[{type:0,value:"Photo by "},{type:1,value:"photoOwner"},{type:0,value:"."}],UNSUPPORTED_FILE_TYPE_PLEASE_JPG:[{type:0,value:"This is an unsupported file type. Please use JPG files for prints."}],PRINT_PHOTOS_WITH_EASE:[{type:0,value:"Print your favorite photos from the best labs with ease."}],WHO_CAN_PRINT_PHOTOS_ANSWER_CONTROL:[{type:0,value:"You have full control over who can print your photos. Keep printing to yourself, share with friends, or share with the world and enjoy the satisfaction of knowing your photos are being appreciated."}],THE_PRINT_SHOP:[{type:0,value:"The Print Shop"}],FROM_THE_PRINT_SHOP:[{type:0,value:"From The Print Shop"}],FINE_SELECTION_FOR_PRINT:[{type:0,value:'A fine selection available for purchase, from our hand-picked photographers. <a class="learn-link" href="'},{type:1,value:"learnUrl"},{type:0,value:'">Learn more.</a>'}],PRINT_THIS_SHOT:[{type:0,value:"Print this shot"}]})}),"@VERSION@",{requires:["intl"]});YUI.add("photo-prints-helper",(function(e,r){var t=require("url-parse"),i=require("hermes-core/flog")(r),n=require("superagent"),s=e.mix({langBundles:["prints"]},e.Localizable),o={default:"prints.SOMETHING_WRONG_PREPARING_PRINT",4:"prints.UNSUPPORTED_FILE_TYPE_PLEASE_JPG"};e.PhotoPrintsHelper=function(r){var a=e.config.flickr.flickrprints.devBaseUrl,l=e.config.flickr.flickrprints.baseUrl,c=e.config.flickr.flickrprints.cartPath,p=e.config.flickr.flickrprints.devApiKey,u=e.config.flickr.flickrprints.apiKey;return{isPrintFeatureEnabled:function(){return r.getViewer().signedIn||!r.getViewer().signedIn&&r.flipper.isFlipped("enable-buy-others-prints")},canPrintPhoto:function(e,t){return this.isPrintFeatureEnabled()&&!e.getValue("isVideo")&&!t.getValue("isIgnoredBy")&&(e.getValue("isOwner")||r.flipper.isFlipped("enable-buy-others-prints")&&!e.getValue("isOwner")&&e.getValue("engagement").getValue("canPrint"))},registerPrint:function(t,i){var n=this;return r.callAPI("flickr.printservice.getRedirectURL",{user_id:t.getValue("owner").getValue("id"),photo_id:t.getValue("id"),return_url:i}).then((function(r){return n.isPrintUrlSafe(r.redirectURL)?{redirectURL:r.redirectURL}:e.Promise.reject({message:n.getRegisterPrintErrorCodeMessage()})})).catch((function(e){throw{message:n.getRegisterPrintErrorCodeMessage(e.code)}}))},isPrintUrlSafe:function(e){var r=new t(e);return"https:"===r.protocol&&"https://"+r.hostname===this.getBaseUrl()},getBaseUrl:function(){return r.flipper.isFlipped("enable-photo-prints-prod-url")?l:a},getApiKey:function(){return r.flipper.isFlipped("enable-photo-prints-prod-url")?u:p},getCartUrl:function(){return this.getBaseUrl()+c},fetchCartCount:function(){var e=this.getBaseUrl()+"/api/v2/cart?APIKey="+this.getApiKey();return n.get(e).withCredentials().set("Accept","application/json").then((function(e){return{count:e&&e.body.Response.Cart?e.body.Response.Cart.ItemCount:0}})).catch((function(e){throw i.error("Error fetching cart count",{err:e}),e}))},fetchOrder:function(e){var r=this.getBaseUrl()+"/api/v2/order/"+e+"?_expand=OrderBillingAddress&APIKey="+this.getApiKey();return n.get(r).withCredentials().set("Accept","application/json").then((function(r){var t="/api/v2/order/"+e+"!billingaddress",i=r.body.Response.Order,n=r.body.Expansions[t];return{orderId:i.OrderID,orderUrl:i.WebUri,email:n.OrderBillingAddress.Email}}))},getRegisterPrintErrorCodeMessage:function(e){var r=e?e.toString():"";return o.hasOwnProperty(r)?s.intlMessage({intlName:o[r]}):s.intlMessage({intlName:o.default})}}}}),"@VERSION@",{requires:[],optionalRequires:["hermes-core"]});