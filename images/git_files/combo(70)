YUI.add("feed-helper",(function(e,t){var a=e.mix({langBundles:["common","feed","feed-new"]},e.Localizable);e.FeedHelper=function(t){var n=new e.PhotoCardHelper(t),r=new e.TemplateLibraryHelper(t),o={photoCardHelper:n,layoutValues:{large:{CARD_SPACING:32,CARD_SPACING_MOBILE:16},medium:{CARD_SPACING:32,TARGET_ROW_HEIGHT:280,TARGET_ROW_HEIGHT_MOBILE:300,TARGET_ROW_HEIGHT_TOLERANCE:.5,GENERATED_LAYOUT_WIDTH:1e3,GENERATED_LAYOUT_SPACING:4,GENERATED_LAYOUT_ROW_HEIGHT_RATIO:.35,GENERATED_LAYOUT_TARGET_ROW_HEIGHT_TOLERANCE:.3,MAX_BATCH_AR:2.5,MIN_BATCH_AR:1},compact:{CARD_SPACING:40,GENERATED_LAYOUT_WIDTH:1e3,GENERATED_LAYOUT_SPACING:4},batchLarge:{CARD_SPACING:16,TARGET_ROW_HEIGHT:320,TARGET_ROW_HEIGHT_MOBILE:300,TARGET_ROW_HEIGHT_TOLERANCE:.3},batchMedium:{CARD_SPACING:32,TARGET_ROW_HEIGHT:320,TARGET_ROW_HEIGHT_MOBILE:300,TARGET_ROW_HEIGHT_TOLERANCE:.3},batchCompact:{CARD_SPACING:32,TARGET_ROW_HEIGHT:320,TARGET_ROW_HEIGHT_MOBILE:300,TARGET_ROW_HEIGHT_TOLERANCE:.3}},EVENT_TYPE_INTL:{Flickrec:{intlName:"feed.RECOMMENDED"},StaticRec:{intlName:"feed.RECOMMENDED"},SelfBatch:null,UploadBatch:null,GroupBatch:{intlName:"feed.GROUPS_ACTIVITY_LABEL"},ad:{intlName:"feed.SPONSORED"},StaticContent_Sponsored:{intlName:"feed.SPONSORED"},StaticContent_General:null,StaticContent_Help:null},PER_BATCH:15,AD_CADENCE:7,getCappedPhotoHeight:function(e){e.height;return Math.min(e.height,Math.max(t.viewportData.getHeight()*e.viewportProportion-e.additionalCardHeight,e.minHeight))},getEventTypeName:function(e){var t=this.EVENT_TYPE_INTL[e];return t?a.intlMessage(t):""},getItemAttribution:function(e){var t={};switch(e.eventType){case"Flickrec":case"StaticRec":case"SelfBatch":case"ad":case"StaticContent_Sponsored":break;case"UploadBatch":t={id:e.photoItems[0].owner.nsid,title:e.photoItems[0].owner.displayname,url:"/photos/"+e.photoItems[0].owner.pathAlias,iconUrl:e.photoItems[0].owner.buddyicon.default,isPro:e.photoItems[0].owner.isPro,proBadgeType:e.photoItems[0].owner.proBadgeType};break;case"GroupBatch":t={id:e.groupId,title:e.groupName,url:"/groups/"+e.groupId,iconUrl:e.iconUrls.default};break;case"StaticContent_General":t={title:a.intlMessage({intlName:"feed.FLICKR_EDITORIAL"}),url:e.staticContent.link};break;case"StaticContent_Help":t={title:a.intlMessage({intlName:"feed.FLICKR_HELP"}),url:e.staticContent.link}}return t.activityName=this.getEventTypeName(e.eventType),t.time=e.time,t},getLinkFooterConfig:function(e){var t={};switch(e.eventType){case"Flickrec":case"StaticRec":case"SelfBatch":case"ad":case"StaticContent_Sponsored":case"StaticContent_General":case"StaticContent_Help":break;case"UploadBatch":t={text:a.intlMessage({intlName:"feed.VIEW_IN_PHOTOSTREAM"}),url:"/photos/"+e.photoItems[0].owner.pathAlias};break;case"GroupBatch":t={text:a.intlMessage({intlName:"feed.VIEW_GROUP_POOL"}),url:"/groups/"+e.groupId+"/pool"}}return t},getEventTypes:function(e){var t="UploadBatch,GroupBatch,ContactRec";return e&&("groups"===e?t="GroupBatch":"people"===e?t="UploadBatch,ContactRec":"friends_and_family"===e&&(t="UploadBatch")),t},convertActivityModel:function(t){var a=this,n=t.getValue("photos").getList(),r=t.getValue("people"),o={id:e.guid(),layoutRenderType:"feedCard",batchId:t.getValue("id"),eventType:t.getValue("eventType"),owner:{nsid:t.getValue("ownerId")},isRecommended:t.getValue("recommended"),isStaticContent:t.getValue("isStaticContent"),isStaticHelp:t.getValue("isStaticHelp"),time:t.getValue("time"),count:t.getValue("count"),model:t};return"GroupBatch"===o.eventType&&(o.groupId=t.getValue("groupId"),o.groupName=t.getValue("groupName"),o.iconUrls=t.getValue("iconUrls")),o.eventType.indexOf("StaticContent")>-1&&(o.staticContent=t.getValue("data")),o.photoItems=n.map((function(e){return a.photoCardHelper.convertPhotoModel(e)})),r&&(o.personItems=r.map((function(e){return a.convertPerson(e)}))),o},convertPerson:function(t){var a=t.model,n=a.getValue("isPro");return{id:e.guid(),nsid:a.getValue("nsid"),url:a.getValue("url"),displayname:a.getValue("displayname"),username:a.getValue("username"),buddyicon:a.getValue("buddyicon"),pathAlias:a.getValue("pathAlias"),isPro:n,proBadgeType:n?a.getValue("proBadge"):void 0,coverPhotoUrls:t.coverPhotoUrls,model:a}},generateListsFromItems:function(e){var t=0,a=[];return e.forEach((function(n,r){"ContactRec"===n.eventType||"ad"===n.eventType?(r>t&&a.push({layoutRenderType:"activityCard",items:e.slice(t,r)}),a.push({layoutRenderType:"ad"===n.eventType?"ad":"people",items:[e[r]]}),t=r+1):r===e.length-1&&a.push({layoutRenderType:"activityCard",items:e.slice(t,r+1)})})),a},promiseSync:function(t,a){var n=this,r=t.shift();return a=a||[],r?r().then((function(e){return a.push(e),n.promiseSync(t,a)})):e.Promise.resolve(a)},getEmptyStateMessage:function(t,n){var o;switch(t){case"all":o=r.getTemplate("feed-error-message")({title:a.intlMessage({intlName:"feed.NO_ACTIVITY_RIGHT_NOW"}),message:a.intlMessage({intlName:"feed.CHECK_OUT_RECS_BELOW"})});break;case"groups":o=r.getTemplate("feed-error-message")({title:a.intlMessage({intlName:"feed.EMPTY_GROUPS_1"}),message:a.intlMessage({intlName:"feed.EMPTY_GROUPS_2",groupsUrl:"/groups"})});break;case"people":o=r.getTemplate("feed-error-message")({title:a.intlMessage({intlName:"feed.EMPTY_PEOPLE_1"}),message:a.intlMessage({intlName:"feed.CHECK_OUT_RECS_BELOW"})});break;case"friends_and_family":o=r.getTemplate("feed-error-message")({title:a.intlMessage({intlName:"feed.EMPTY_FRIENDS_AND_FAMILY_1"}),message:a.intlMessage({intlName:"feed.EMPTY_FRIENDS_AND_FAMILY_2",peopleUrl:e.URLHelper.generatePersonUrls(n).list})});break;default:o=r.getTemplate("feed-error-message")({title:a.intlMessage({intlName:"feed.NO_ACTIVITY_RIGHT_NOW"}),message:a.intlMessage({intlName:"feed.NO_ACTIVITY_RIGHT_NOW"})})}return o}};return e.augment(o,e.EventTarget),o}}),"@VERSION@",{requires:["event-custom","storage-helper","photo-card-helper","url-helper","fluid-share-photo-view","fluid-share-photostream-view","hermes-template-feed-error-message"]});YUI.add("hermes-template-reboot-welcome-dialog-content",(function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,o,a){return"\tWhile we continue to develop the beta experience, we want your feedback. In case you need some of the missing functionality, you can easily opt-out and go back to the old experience.\n"},3:function(e,t,n,o,a){return"\tPlease continue providing us with feedback so we can continue to improve Flickr.\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,o,a){var r,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"Flickr is about the amazing photos you capture and the communities that you build around these photos. The goal of our photo page redesign is to provide you with a fast photo browsing experience and an easy interface to build &amp; maintain relationships.<br>\n<br>\nOver the last 4 weeks, we received a lot of feedback from the Flickr community regarding the photo page design. Based on the feedback, we are experimenting with different variations of the photo page to identify the best experience.<br>\n<br>\n"+(null!=(r=i(n,"if").call(null!=t?t:e.nullContext||{},null!=t?i(t,"opt-out-enabled"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.program(3,a,0),data:a,loc:{start:{line:5,column:0},end:{line:9,column:7}}}))?r:"")+"<br>"},useData:!0}),o={};e.Array.each([],(function(t){var n=e.Template.get("hermes/"+t);n&&(o[t]=n)})),e.Template.register("hermes/reboot-welcome-dialog-content",(function(t,a){return(a=a||{}).partials=a.partials?e.merge(o,a.partials):o,n(t,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-photo-opt-out",(function(e,t){var n=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,t,n,l,r){var a,o=null!=t?t:e.nullContext||{},u=e.hooks.helperMissing,i="function",p=e.escapeExpression,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<form action="//'+p(typeof(a=null!=(a=s(n,"host")||(null!=t?s(t,"host"):t))?a:u)===i?a.call(o,{name:"host",hash:{},data:r,loc:{start:{line:1,column:16},end:{line:1,column:24}}}):a)+'/help/optin" method="post">\n\t<input type="hidden" name="photo_opt" value="0">\n\t<input type="hidden" name="redirect_url" value="'+p(typeof(a=null!=(a=s(n,"redirect-url")||(null!=t?s(t,"redirect-url"):t))?a:u)===i?a.call(o,{name:"redirect-url",hash:{},data:r,loc:{start:{line:3,column:49},end:{line:3,column:65}}}):a)+'">\n\t<input type="submit" class="ui-button" value="Go back to the old experience">\n</form>'},useData:!0}),l={};e.Array.each([],(function(t){var n=e.Template.get("hermes/"+t);n&&(l[t]=n)})),e.Template.register("hermes/photo-opt-out",(function(t,r){return(r=r||{}).partials=r.partials?e.merge(l,r.partials):l,n(t,r)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-photo-well-media",(function(n,l){var t=n.Template.Handlebars.revive({1:function(n,l,t,e,a){var o,i=null!=l?l:n.nullContext||{},s=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t<div class="restricted-interstitial">\n\t\t<div class="restricted-interstitial-message">\n\t\t\t<h2>'+n.escapeExpression((s(t,"intlMessage")||l&&s(l,"intlMessage")||n.hooks.helperMissing).call(i,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADULT_CONTENT"},data:a,loc:{start:{line:4,column:7},end:{line:4,column:66}}}))+"</h2>\n"+(null!=(o=s(t,"if").call(i,null!=l?s(l,"isSignedIn"):l,{name:"if",hash:{},fn:n.program(2,a,0),inverse:n.program(5,a,0),data:a,loc:{start:{line:5,column:3},end:{line:14,column:10}}}))?o:"")+"\t\t</div>\n\t</div>\n"},2:function(n,l,t,e,a){var o,i=null!=l?l:n.nullContext||{},s=n.hooks.helperMissing,r=n.escapeExpression,c=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"\t\t\t\t<p>"+r((c(t,"intlMessage")||l&&c(l,"intlMessage")||s).call(i,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.MATURE_AUDIENCES"},data:a,loc:{start:{line:6,column:7},end:{line:6,column:69}}}))+"<br />"+r((c(t,"intlMessage")||l&&c(l,"intlMessage")||s).call(i,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.USER_DISCRETION"},data:a,loc:{start:{line:6,column:75},end:{line:6,column:136}}}))+"</p>\n\n"+(null!=(o=c(t,"unless").call(i,null!=l?c(l,"isMinor"):l,{name:"unless",hash:{},fn:n.program(3,a,0),inverse:n.noop,data:a,loc:{start:{line:8,column:4},end:{line:11,column:15}}}))?o:"")},3:function(n,l,t,e,a){var o=null!=l?l:n.nullContext||{},i=n.hooks.helperMissing,s=n.escapeExpression,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"\t\t\t\t\t<p><button class='ui-button'><span>"+s((r(t,"intlMessage")||l&&r(l,"intlMessage")||i).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SHOW_ME_THIS_CONTENT_TYPE"},data:a,loc:{start:{line:9,column:40},end:{line:9,column:111}}}))+"</span></button></p>\n\t\t\t\t\t<p>"+s((r(t,"intlHTMLMessage")||l&&r(l,"intlHTMLMessage")||i).call(o,{name:"intlHTMLMessage",hash:{intlName:"photo-page-scrappy.CHANGE_SAFE_SEARCH_IN_SETTINGS"},data:a,loc:{start:{line:10,column:8},end:{line:10,column:88}}}))+"</p>\n"},5:function(n,l,t,e,a){var o,i=null!=l?l:n.nullContext||{},s=n.hooks.helperMissing,r=n.escapeExpression,c=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"\t\t\t\t<p>"+r((c(t,"intlMessage")||l&&c(l,"intlMessage")||s).call(i,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SIGNED_IN_FOR_CONTENT"},data:a,loc:{start:{line:13,column:7},end:{line:13,column:74}}}))+' <a href="//'+r("function"==typeof(o=null!=(o=c(t,"host")||(null!=l?c(l,"host"):l))?o:s)?o.call(i,{name:"host",hash:{},data:a,loc:{start:{line:13,column:86},end:{line:13,column:94}}}):o)+'/signin/" data-track="photoWellSignInClick">'+r((c(t,"intlMessage")||l&&c(l,"intlMessage")||s).call(i,{name:"intlMessage",hash:{intlName:"common.SIGN_IN"},data:a,loc:{start:{line:13,column:138},end:{line:13,column:179}}}))+"</a></p>\n"},7:function(n,l,t,e,a){var o,i=null!=l?l:n.nullContext||{},s=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"\n"+(null!=(o=s(t,"if").call(i,null!=l?s(l,"isVideo"):l,{name:"if",hash:{},fn:n.program(8,a,0),inverse:n.program(11,a,0),data:a,loc:{start:{line:19,column:2},end:{line:36,column:9}}}))?o:"")+(null!=(o=s(t,"if").call(i,null!=l?s(l,"isAd"):l,{name:"if",hash:{},fn:n.program(14,a,0),inverse:n.noop,data:a,loc:{start:{line:37,column:1},end:{line:40,column:8}}}))?o:"")},8:function(n,l,t,e,a){var o,i,s=null!=l?l:n.nullContext||{},r=n.hooks.helperMissing,c="function",u=n.escapeExpression,h=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t<div class="videoplayer main-photo" style="width:'+u(typeof(i=null!=(i=h(t,"width")||(null!=l?h(l,"width"):l))?i:r)===c?i.call(s,{name:"width",hash:{},data:a,loc:{start:{line:20,column:52},end:{line:20,column:61}}}):i)+"px; height:"+u(typeof(i=null!=(i=h(t,"height")||(null!=l?h(l,"height"):l))?i:r)===c?i.call(s,{name:"height",hash:{},data:a,loc:{start:{line:20,column:72},end:{line:20,column:82}}}):i)+'px;"><video id="video_1" poster="'+u(typeof(i=null!=(i=h(t,"src")||(null!=l?h(l,"src"):l))?i:r)===c?i.call(s,{name:"src",hash:{},data:a,loc:{start:{line:20,column:115},end:{line:20,column:122}}}):i)+'" class="video-js vjs-big-play-centered inherit-size '+(null!=(o=(h(t,"isFlipped")||l&&h(l,"isFlipped")||r).call(s,"enable-photo-page-lightbox-updates",{name:"isFlipped",hash:{},fn:n.program(9,a,0),inverse:n.noop,data:a,loc:{start:{line:20,column:175},end:{line:20,column:273}}}))?o:"")+'"></video></div>\n'},9:function(n,l,t,e,a){return"vjs-show-big-play-button-on-pause"},11:function(n,l,t,e,a){var o,i,s=null!=l?l:n.nullContext||{},r=n.hooks.helperMissing,c=n.escapeExpression,u="function",h=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\n\t\t\t<div class="facade-of-protection-neue '+(null!=(o=h(t,"if").call(s,null!=l?h(l,"is-video"):l,{name:"if",hash:{},fn:n.program(12,a,0),inverse:n.noop,data:a,loc:{start:{line:23,column:41},end:{line:23,column:72}}}))?o:"")+'">\n\t\t\t\t'+c((h(t,"outlet")||l&&h(l,"outlet")||r).call(s,null!=l?h(l,"zoom-view"):l,{name:"outlet",hash:{},data:a,loc:{start:{line:24,column:4},end:{line:24,column:24}}}))+'\n\t\t\t</div>\n\n\t\t\t<img width="'+c(typeof(i=null!=(i=h(t,"width")||(null!=l?h(l,"width"):l))?i:r)===u?i.call(s,{name:"width",hash:{},data:a,loc:{start:{line:27,column:15},end:{line:27,column:24}}}):i)+'" height="'+c(typeof(i=null!=(i=h(t,"height")||(null!=l?h(l,"height"):l))?i:r)===u?i.call(s,{name:"height",hash:{},data:a,loc:{start:{line:27,column:34},end:{line:27,column:44}}}):i)+'" src="'+c(typeof(i=null!=(i=h(t,"src")||(null!=l?h(l,"src"):l))?i:r)===u?i.call(s,{name:"src",hash:{},data:a,loc:{start:{line:27,column:51},end:{line:27,column:58}}}):i)+'" class="low-res-photo" alt="'+c(typeof(i=null!=(i=h(t,"imgAltText")||(null!=l?h(l,"imgAltText"):l))?i:r)===u?i.call(s,{name:"imgAltText",hash:{},data:a,loc:{start:{line:27,column:87},end:{line:27,column:101}}}):i)+'">\n\t\t\t<img width="'+c(typeof(i=null!=(i=h(t,"width")||(null!=l?h(l,"width"):l))?i:r)===u?i.call(s,{name:"width",hash:{},data:a,loc:{start:{line:28,column:15},end:{line:28,column:24}}}):i)+'" height="'+c(typeof(i=null!=(i=h(t,"height")||(null!=l?h(l,"height"):l))?i:r)===u?i.call(s,{name:"height",hash:{},data:a,loc:{start:{line:28,column:34},end:{line:28,column:44}}}):i)+'" src="'+c(typeof(i=null!=(i=h(t,"highResSrc")||(null!=l?h(l,"highResSrc"):l))?i:r)===u?i.call(s,{name:"highResSrc",hash:{},data:a,loc:{start:{line:28,column:51},end:{line:28,column:65}}}):i)+'" class="main-photo is-hidden" alt="'+c(typeof(i=null!=(i=h(t,"imgAltText")||(null!=l?h(l,"imgAltText"):l))?i:r)===u?i.call(s,{name:"imgAltText",hash:{},data:a,loc:{start:{line:28,column:101},end:{line:28,column:115}}}):i)+'">\n\t\t\t<script nonce="'+c(typeof(i=null!=(i=h(t,"cspNonce")||(null!=l?h(l,"cspNonce"):l))?i:r)===u?i.call(s,{name:"cspNonce",hash:{},data:a,loc:{start:{line:29,column:18},end:{line:29,column:30}}}):i)+"\">\n\t\t\tvar img = document.querySelector('.photo-well-media-view img.main-photo');\n\t\t\timg.onload = function () { registerFirstPhoto(img); };\n\t\t\t<\/script>\n\t\t\t<noscript>\n\t\t\t\t<img width=\""+c(typeof(i=null!=(i=h(t,"width")||(null!=l?h(l,"width"):l))?i:r)===u?i.call(s,{name:"width",hash:{},data:a,loc:{start:{line:34,column:16},end:{line:34,column:25}}}):i)+'" height="'+c(typeof(i=null!=(i=h(t,"height")||(null!=l?h(l,"height"):l))?i:r)===u?i.call(s,{name:"height",hash:{},data:a,loc:{start:{line:34,column:35},end:{line:34,column:45}}}):i)+'" src="'+c(typeof(i=null!=(i=h(t,"highResSrc")||(null!=l?h(l,"highResSrc"):l))?i:r)===u?i.call(s,{name:"highResSrc",hash:{},data:a,loc:{start:{line:34,column:52},end:{line:34,column:66}}}):i)+'" class="main-photo" alt="'+c(typeof(i=null!=(i=h(t,"imgAltText")||(null!=l?h(l,"imgAltText"):l))?i:r)===u?i.call(s,{name:"imgAltText",hash:{},data:a,loc:{start:{line:34,column:92},end:{line:34,column:106}}}):i)+'">\n\t\t\t</noscript>\n'},12:function(n,l,t,e,a){return"is-video"},14:function(n,l,t,e,a){var o,i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t\t\t<span class="ad-info">'+n.escapeExpression((i(t,"intlHTMLMessage")||l&&i(l,"intlHTMLMessage")||n.hooks.helperMissing).call(null!=l?l:n.nullContext||{},{name:"intlHTMLMessage",hash:{brand:null!=(o=null!=l?i(l,"ad"):l)?i(o,"brand"):o,intlName:"photo-page-scrappy.FIND_OUT_MORE_AD"},data:a,loc:{start:{line:38,column:25},end:{line:38,column:106}}}))+"</span>\n\t\t</a>\n"},compiler:[8,">= 4.3.0"],main:function(n,l,t,e,a){var o,i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(o=i(t,"if").call(null!=l?l:n.nullContext||{},null!=l?i(l,"needsInterstitial"):l,{name:"if",hash:{},fn:n.program(1,a,0),inverse:n.program(7,a,0),data:a,loc:{start:{line:1,column:0},end:{line:41,column:7}}}))?o:""},useData:!0}),e={};n.Array.each([],(function(l){var t=n.Template.get("hermes/"+l);t&&(e[l]=t)})),n.Template.register("hermes/photo-well-media",(function(l,a){return(a=a||{}).partials=a.partials?n.merge(e,a.partials):e,t(l,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-well-media-view",(function(e,t){var i,o=require("hermes-core/flog")(t);i={photo:{render:function(){var t,i,o=this,n=this.get("photo"),a=new Date,s="";return o.preloadImage&&(o.preloadImage.onload=null),t=this.getPhotoForDisplay(),i=this.getPhotoForDisplay({includeSizes:["sq","q","t","s","n"]}),n.getValue("owner")&&(s=""===n.getValue("title").trim()?this.intlMessage({intlName:"common.UNTITLED"}):n.getValue("title"),s+=" | "+this.intlMessage({intlName:"common.BY_USER",user:n.getValue("owner").getValue("username")})),this.setContainerWithTemplate("photo-well-media",{width:t.width,height:t.height,src:i.url,highResSrc:t.url,imgAltText:s,needsInterstitial:n.getValue("needsInterstitial"),isSignedIn:this.appContext.getViewer().signedIn,isVideo:n.getValue("isVideo"),isMinor:this.appContext.getViewer().isMinor,isAd:this.isAd}),this.fire("subviewViewEvent",t),YUI.Env.isServer?(this.serverWidth=t.width,this.serverHeight=t.height):n.getValue("needsInterstitial")||(o.preloadImage=new Image,o.preloadImage.onload=function(){if(!this.onloadFired&&o.isActiveAndInDOM()){this.onloadFired=!0;var i,n="photoPageShowedSize",s="ø";try{(i=/(?:_([a-z]))?\.jpg/.exec(t.url))&&i[1]&&(s=i[1])}catch(e){}finally{n+=String(s).toUpperCase()}e.rapidTracker.beacon(this.name,n);var r,l=o.get("container").one(".low-res-photo"),h=o.get("container").one(".main-photo");new Date-a<100?(h.removeClass("is-hidden").show(),l.hide()):(h.setStyles({position:"absolute",left:0,top:0,opacity:0}),h.removeClass("is-hidden"),r=function(){h.removeAttribute("style"),l.hide()},e.UA.ie?r():e.use("transition",(function(e){h.transition({duration:.25,opacity:1},r)})))}},o.preloadImage.src=t.url,o.preloadImage.complete&&o.preloadImage.onload()),this}},video:{render:function(){var e=this.get("photo"),t=this.getPhotoForDisplay({excludeSizes:[]}),i=t.url;return this.appContext.flipper.isFlipped("disable-video-playback")&&(i="/images/en-us/video-unavailable/m.png"),!this.player||e.getValue("isVideoPending")||e.getValue("isVideoFailed")?(this.setContainerWithTemplate("photo-well-media",{width:t.width,height:t.height,src:i,needsInterstitial:e.getValue("needsInterstitial"),isVideo:e.getValue("isVideo"),isSignedIn:this.appContext.getViewer().signedIn,"zoom-view":""}),this.fire("subviewViewEvent",t),this):(e.getValue("isVideoPending")||e.getValue("isVideoFailed")||(this.player.dimension?(this.player.dimension("width",t.width),this.player.dimension("height",t.height)):this.player.resize(t.width,t.height)),this)}},ad:{render:function(){return this}}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"zoom-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disableIfSmall:!0}},initializer:function(e){return this.photoId=e.photoId,this.isAd=!!e.ad,this.ad=e.ad,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},loadState:function(){var t=this;return this.appContext.getModel("photo-models",t.photoId).then((function(i){if(t.set("photo",i),i.getValue("isVideo"))return new e.Promise((function(t,i){e.use("flickr-video-player",(function(){t()}))}))}))},buildContainer:function(){return YUI.Env.isServer||this.set("clientRendered",!0),this.isAd?i.ad.render.call(this):i[this.get("photo").getValue("isVideo")?"video":"photo"].render.call(this),this},handleInterstitialDismissButtonClick:function(t){var i=this,n=this.get("personPreferences"),a=this.get("photo"),s=a.getValue("safetyLevel");e.rapidTracker.beacon(this.name,"restrictedContentInterstitialClick"),n.setValue("safeSearch",s),n.registry.remoteUpdate(i.appContext.auth.user.nsid).then((function(e){a.registry.attributeSearch({needsInterstitial:!0}).forEach((function(e){a.registry.getValue(e,"safetyLevel")<=n.getValue("safeSearch")&&a.registry.setValue(e,"needsInterstitial",!1)})),i.buildContainer()}),(function(e){o.error({err:e}),i.onError(i.intlMessage({intlName:"photo-page-scrappy.COULDNT_UPDATE_SETTINGS"}))}))},activate:function(){var t,i=this,o=i.get("photo"),n=this.getPhotoForDisplay(),a=this.get("container").one(".main-photo");return!o.getValue("isVideo")||o.getValue("isVideoPending")||o.getValue("isVideoFailed")||(i.player=new e.FlickrVideoPlayer({container:i.get("container").one(".videoplayer"),model:o,appContext:i.appContext,videoNode:e.one("#video_1")?e.one("#video_1")._node:null,autoplay:!0,loop:!0,controlBar:{fullscreenToggle:!1}}),i.player.init().then((function(){if(this.appContext.flipper.isFlipped("enable-photo-page-lightbox-updates")){i.player.player.controlBar.dispose();var e=i.player.player.addChild("ControlBar",{fullscreenToggle:!1});i.player.player.on("pause",(()=>{i.player.player.seeking()||i.fire("subviewViewEvent","videoPause")})),i.player.player.on("play",(()=>{i.fire("subviewViewEvent","videoPlay")})),i.player.player.on("touchend",(()=>{i.player.player.paused?i.player.play():i.player.pause()})),i.fire("subviewViewEvent","videoPlayerInitialized",e)}})),i.on("destroy",(function(){i.player&&(i.player.destroy(),i.player=null)}))),o.getValue("needsInterstitial")||(e.use("global-events",(function(e){i.registerEventHandler(e.globalEvents.subscribe("window:resize",(function(e){i.set("canvasSizeIsDirty",!0),i.buildContainer()})))})),this.registerEventHandler(e.on("flickr:photo-media-well-update",(function(e){i.set("canvasSizeIsDirty",!0),i.buildContainer()}))),!this.isAd&&(!i.get("clientRendered")||a&&n.width!==Number(a.getAttribute("width"))||a&&n.height!==Number(a.getAttribute("height")))&&i.buildContainer()),this.registerEventHandler(e.on("flickr:display-note-box",(function(o){t=e.Node.create('<div class="note-box"></div>'),i.get("container").one(".main-photo").getXY(),i.get("container").append(t),t.setStyles({top:o.noteBoxTop+i.get("container").one(".main-photo").getDOMNode().offsetTop,left:o.noteBoxLeft,width:o.noteBoxWidth,height:o.noteBoxHeight})}))),this.appContext.getViewer().signedIn&&this.appContext.getModel("person-preferences-models",i.appContext.auth.user.nsid).then((function(e){i.set("personPreferences",e),o.getValue("needsInterstitial")&&!this.appContext.getViewer().isMinor&&i.registerEventHandler(i.get("container").one(".restricted-interstitial-message button").on("click",i.handleInterstitialDismissButtonClick,i))})),this},onError:function(t){new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,showBodyLines:!0,showCancelButton:!1,showCancelX:!0,title:this.intlMessage({intlName:"common.ERROR"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),htmlMessage:t}).show()},getPhotoForDisplay:function(e){var t,i,o=this.getCanvasSize(),n=this.getPixelRatio(),a=this.get("photo").getSizeToFit(o,e);return t=Math.min(o.height/n,a.height),i=Math.min(o.width/n,a.width/a.height*t),t=Math.min(t,a.height/a.width*i),{width:Math.round(i),height:Math.round(t),url:a.url,pixelRatio:a.width/i}},getCanvasSize:function(){var e,t,i=this.getPixelRatio();return this.get("canvasSizeIsDirty")?YUI.Env.isServer||(t=this.get("container").ancestor())&&(e=t.get("region")).width>0&&e.height>0&&(this.set("canvasSizeIsDirty",!1),this.set("cachedCanvasSize",e),this.appContext.setCookie({remove:!0,cookieName:"photoPW",path:"/photos/",cookieValue:e.width}),this.appContext.setCookie({remove:!0,cookieName:"photoPH",path:"/photos/",cookieValue:e.height}),this.appContext.setCookie({remove:!0,cookieName:"density",path:"/photos/",cookieValue:i})):e=this.get("cachedCanvasSize"),e||(e={top:0,left:0,bottom:500,right:500,width:parseInt(this.appContext.getCookie("photoPW"),10)||500,height:parseInt(this.appContext.getCookie("photoPH"),10)||500}),e.height*=i,e.width*=i,e},getPixelRatio:function(){return this.appContext.getViewer().getPixelRatio()}},{ATTRS:{canvasSizeIsDirty:{value:!0,setter:function(e){return!!e}},cachedCanvasSize:{getter:function(t){return e.merge(t)},setter:function(t){return e.merge(t)}}}})}),"@VERSION@",{requires:["flickr-view","hermes-template-photo-well-media","moment","zoom-view"],optionalRequires:["hermes-core"],optional:["photo-models"],langBundles:["common","photo-page-scrappy"]});YUI.add("hermes-template-head-meta",(function(e,n){var a=e.Template.Handlebars.revive({1:function(e,n,a,t,l){return'name="'},3:function(e,n,a,t,l){return'property="'},5:function(e,n,a,t,l){return'description="'+e.escapeExpression(e.lambda(n,n))+'"'},compiler:[8,">= 4.3.0"],main:function(e,n,a,t,l){var r,o,i,m=null!=n?n:e.nullContext||{},s=e.hooks.helperMissing,c="function",u=e.escapeExpression,p=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]},d="<meta "+(null!=(r=p(a,"if").call(m,null!=n?p(n,"isName"):n,{name:"if",hash:{},fn:e.program(1,l,0),inverse:e.program(3,l,0),data:l,loc:{start:{line:1,column:6},end:{line:1,column:51}}}))?r:"")+u(typeof(o=null!=(o=p(a,"metaName")||(null!=n?p(n,"metaName"):n))?o:s)===c?o.call(m,{name:"metaName",hash:{},data:l,loc:{start:{line:1,column:51},end:{line:1,column:63}}}):o)+'" content="'+u((p(a,"renderMetaInfo")||n&&p(n,"renderMetaInfo")||s).call(m,null!=n?p(n,"metaValue"):n,{name:"renderMetaInfo",hash:{},data:l,loc:{start:{line:1,column:74},end:{line:1,column:102}}}))+'" ';return o=null!=(o=p(a,"metaDescription")||(null!=n?p(n,"metaDescription"):n))?o:s,i={name:"metaDescription",hash:{},fn:e.program(5,l,0),inverse:e.noop,data:l,loc:{start:{line:1,column:104},end:{line:1,column:163}}},r=typeof o===c?o.call(m,i):o,p(a,"metaDescription")||(r=e.hooks.blockHelperMissing.call(n,r,i)),null!=r&&(d+=r),d+' data-dynamic="true">\n'},useData:!0}),t={};e.Array.each([],(function(n){var a=e.Template.get("hermes/"+n);a&&(t[n]=a)})),e.Template.register("hermes/head-meta",(function(n,l){return(l=l||{}).partials=l.partials?e.merge(t,l.partials):t,a(n,l)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-head-link",(function(n,e){var l=n.Template.Handlebars.revive({1:function(n,e,l,o,t){var a,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'id="'+n.escapeExpression("function"==typeof(a=null!=(a=r(l,"id")||(null!=e?r(e,"id"):e))?a:n.hooks.helperMissing)?a.call(null!=e?e:n.nullContext||{},{name:"id",hash:{},data:t,loc:{start:{line:1,column:20},end:{line:1,column:26}}}):a)+'"'},3:function(n,e,l,o,t){var a,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'rev="'+n.escapeExpression("function"==typeof(a=null!=(a=r(l,"rev")||(null!=e?r(e,"rev"):e))?a:n.hooks.helperMissing)?a.call(null!=e?e:n.nullContext||{},{name:"rev",hash:{},data:t,loc:{start:{line:1,column:51},end:{line:1,column:58}}}):a)+'"'},5:function(n,e,l,o,t){var a,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'rel="'+n.escapeExpression("function"==typeof(a=null!=(a=r(l,"rel")||(null!=e?r(e,"rel"):e))?a:n.hooks.helperMissing)?a.call(null!=e?e:n.nullContext||{},{name:"rel",hash:{},data:t,loc:{start:{line:1,column:83},end:{line:1,column:90}}}):a)+'"'},7:function(n,e,l,o,t){var a,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'type="'+n.escapeExpression("function"==typeof(a=null!=(a=r(l,"type")||(null!=e?r(e,"type"):e))?a:n.hooks.helperMissing)?a.call(null!=e?e:n.nullContext||{},{name:"type",hash:{},data:t,loc:{start:{line:1,column:117},end:{line:1,column:125}}}):a)+'"'},9:function(n,e,l,o,t){var a,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'media="'+n.escapeExpression("function"==typeof(a=null!=(a=r(l,"media")||(null!=e?r(e,"media"):e))?a:n.hooks.helperMissing)?a.call(null!=e?e:n.nullContext||{},{name:"media",hash:{},data:t,loc:{start:{line:1,column:154},end:{line:1,column:163}}}):a)+'"'},11:function(n,e,l,o,t){var a,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'href="'+n.escapeExpression("function"==typeof(a=null!=(a=r(l,"href")||(null!=e?r(e,"href"):e))?a:n.hooks.helperMissing)?a.call(null!=e?e:n.nullContext||{},{name:"href",hash:{},data:t,loc:{start:{line:1,column:190},end:{line:1,column:198}}}):a)+'"'},13:function(n,e,l,o,t){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'data-dynamic-added-by="'+n.escapeExpression((a(l,"obfuscateInternals")||e&&a(e,"obfuscateInternals")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},null!=e?a(e,"addedBy"):e,{name:"obfuscateInternals",hash:{},data:t,loc:{start:{line:1,column:245},end:{line:1,column:275}}}))+'"'},compiler:[8,">= 4.3.0"],main:function(n,e,l,o,t){var a,r=null!=e?e:n.nullContext||{},u=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"<link "+(null!=(a=u(l,"if").call(r,null!=e?u(e,"id"):e,{name:"if",hash:{},fn:n.program(1,t,0),inverse:n.noop,data:t,loc:{start:{line:1,column:6},end:{line:1,column:34}}}))?a:"")+" "+(null!=(a=u(l,"if").call(r,null!=e?u(e,"rev"):e,{name:"if",hash:{},fn:n.program(3,t,0),inverse:n.noop,data:t,loc:{start:{line:1,column:35},end:{line:1,column:66}}}))?a:"")+" "+(null!=(a=u(l,"if").call(r,null!=e?u(e,"rel"):e,{name:"if",hash:{},fn:n.program(5,t,0),inverse:n.noop,data:t,loc:{start:{line:1,column:67},end:{line:1,column:98}}}))?a:"")+" "+(null!=(a=u(l,"if").call(r,null!=e?u(e,"type"):e,{name:"if",hash:{},fn:n.program(7,t,0),inverse:n.noop,data:t,loc:{start:{line:1,column:99},end:{line:1,column:133}}}))?a:"")+" "+(null!=(a=u(l,"if").call(r,null!=e?u(e,"media"):e,{name:"if",hash:{},fn:n.program(9,t,0),inverse:n.noop,data:t,loc:{start:{line:1,column:134},end:{line:1,column:171}}}))?a:"")+" "+(null!=(a=u(l,"if").call(r,null!=e?u(e,"href"):e,{name:"if",hash:{},fn:n.program(11,t,0),inverse:n.noop,data:t,loc:{start:{line:1,column:172},end:{line:1,column:206}}}))?a:"")+" "+(null!=(a=u(l,"if").call(r,null!=e?u(e,"addedBy"):e,{name:"if",hash:{},fn:n.program(13,t,0),inverse:n.noop,data:t,loc:{start:{line:1,column:207},end:{line:1,column:283}}}))?a:"")+' data-dynamic="true" />'},useData:!0}),o={};n.Array.each([],(function(e){var l=n.Template.get("hermes/"+e);l&&(o[e]=l)})),n.Template.register("hermes/head-link",(function(e,t){return(t=t||{}).partials=t.partials?n.merge(o,t.partials):o,l(e,t)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});